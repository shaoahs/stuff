import{g as e,b as t,a as i,e as n,o as s,O as a,G as r,d as o,r as l,c,I as g,f as h,h as u,T as d,j as m,k as p}from"./agent.1daeec9a.js";import f from"mithril";import*as b from"nuts";import w from"localforage";let v=!1;function y(){return v}let x="title";function L(){return x}let T="message";function C(){return T}function E(e){x=e.title,T=e.msg,v=!0,f.redraw()}function k(){v=!1,f.redraw()}var R=Object.freeze({__proto__:null,getMessage:C,getTitle:L,hide:k,isVisible:y,show:E});let O=null,M={oninit(e){let t=e.attrs;this.style=t.style,this.complete=t.complete,this.logo=null},async oncreate(e){let t=this,i=e.attrs,n=e.dom,s=i.url,a=await fetch(s);if(a&&a.ok){let e=await a.blob();const i=URL.createObjectURL(e);n.src=i,f.redraw(),t.complete&&t.complete()}},view(){return f("img",{style:this.style})}},I={timeBase:1,oninit(e){let t=e.attrs;this.class=t.class||"ba b--light-blue animate__animated animate__bounceIn",this.style=t.style||{left:"0%",top:"0%",width:"100%",height:"100%"},this.info=t.info,this.serve=t.serve,this.config=t.config||{width:300,height:200,resolution:1,antialias:!1,transparent:!0},this.id=t.id,this.group=t.group,this.title=t.title||"標題",this.logo=t.logo,this.game=null,this.eventClass={current:"ba b--dotted bw1 white-50",onmouseenter:"ba b--dotted bw2 white-50",onmouseleave:"ba b--dotted bw1 white-50"}},onbeforeremove(e){let t=this;return t.game&&t.game.pause(),["animate__animated","animate__lightSpeedOut"].forEach((t=>{e.dom.classList.add(t)})),new Promise((e=>{b.updateManager.setTimeout(e,.4)}))},view(){let t=this,i=t.eventClass;return f(".",{class:t.class,style:t.style},[f(".game-card-title",t.title),f(M,{class:"game-card-view ba b--light-gray",style:{zValue:0,position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"},url:t.logo,complete(){}}),f(".",{onclick(){globalThis.Howl&&(O||(O=new globalThis.Howl({src:["data/f82550ea2e80cd97.wav"]}),O.volume(.01)),O.play()),oi(!1),Pt({serve:t.serve,id:t.id,group:t.group})},onmouseenter(){i.current=i.onmouseenter,f.redraw()},onmouseleave(){i.current=i.onmouseleave,f.redraw()},class:i.current,style:{position:"absolute",left:"10%",top:"10%",width:"80%",height:"75%"}}),f(".game-card-download",{onclick(){E({yesno:!1,title:"connecting",msg:"disconnect"})}},[f.trust(`<div class="no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma2 tc br2 pa2">\n    <svg fill="#77ff77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">\n    <path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"/>\n    <path d="M0 0h24v24H0z" fill="none"/>\n</svg>\n    <span class="f6 ml3 pr2">${e("download")}</span>\n  </div>`)]),f(".game-card-stop",{onclick(){si({url:"https://127.0.0.1:3000/project/agent/"})}},[f.trust(`<div class="no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma2 tc br2 pa2">\n    <svg fill="#77ff77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">\n    <path d="M0 0h24v24H0z" fill="none"/>\n    <path d="M14.59 8L12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41 14.59 8zM12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>\n</svg>\n    <span class="f6 ml3 pr2">${e("stop")}</span>\n  </div>`)])])}},_={left:"0px",top:"0px",width:"300px",height:"200px"},P={},F={},U=null;function $(e){return P[e]||(P[e]={}),F=P[e],F}function z(e,t,n,r){let o={};function l(){let e=i.registration;e&&e.active&&navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage(o):b.updateManager.setTimeout(l,.05)}if(!i.versionTimestamp){let e=new Date;i.versionTimestamp=e.getTime()}let c=i.versionTimestamp,g=!1,h=null;return h=new Promise((h=>{if(!e||!t)return void h(null);function u(){let r=`config/${t}/${e}/gamecard.txt?v=${c}`,u=`config/${t}/${e}/cache.txt`;if(n){let i=n;"/"===i[i.length-1]&&(i=i.substring(0,i.length-1)),r=`${i}/config/${t}/${e}/gamecard.txt?v=${c}`,u=`${i}/config/${t}/${e}/cache.txt`}else r=`config/${t}/${e}/gamecard.txt?v=${c}`,u=`config/${t}/${e}/cache.txt`;o.cacheName=`${t}${e}`,o.url=u,i.useCache&&l(),fetch(r,{headers:{"Content-Type":"text/plain"}}).then((e=>e.ok?e.text():null)).then((e=>{if(!e)return;let t={},r=new String(e),o=r.indexOf("{");if(o>=0&&o<=9){let e=JSON.parse(r);if(!e.options||!e.options.overview){let e=a;i.useOptions||(s[e.OVERVIEW_LOGO]=1,s[e.OVERVIEW_ANIMATION]=0,s[e.OVERVIEW_BACKGROUND]=0,s[e.OVERVIEW_PROGRESS]=1)}if(e.templateVersion="slot.2.1",t.gameCard=e,n){let e=n;"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),t.gameCard.baseURL=`${e}/`}g=!0,h(t)}})).catch((e=>{}))}let d,m;if(n){let i=n;"/"===i[i.length-1]&&(i=i.substring(0,i.length-1)),r?d=`${i}/${t}/${e}/config/v${r}.txt`:(d=`${i}/${t}/${e}/config/gamecard.txt?v=${c}`,m=`${i}/${t}/${e}/config/cache.txt`)}else r?d=`${i.projectURL}${t}/${e}/config/v${r}.txt`:(d=`${i.projectURL}${t}/${e}/config/gamecard.txt?v=${c}`,m=`${i.projectURL}${t}/${e}/config/cache.txt`);o.cacheName=`${t}${e}`,o.url=m,i.useCache&&l(),fetch(d,{headers:{"Content-Type":"text/plain"}}).then((e=>e.ok?e.text():(u(),null))).then((e=>{if(!e)return;let t={},s=new String(e),a=s.indexOf("{");if(a>=0&&a<=9){if(t.gameCard=JSON.parse(s),n)if(t.gameCard.baseURL){let e=n;"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),t.gameCard.baseURL=e+t.gameCard.baseURL.replace(i.projectURL,"/")}else t.gameCard.baseURL=n;else{let e=globalThis.location.origin;t.gameCard.baseURL?t.gameCard.baseURL.indexOf("://")<0&&(t.gameCard.baseURL=e+t.gameCard.baseURL):t.gameCard.baseURL=globalThis.location.origin+"/"}g=!0,h(t)}if(g)return!0;u()})).catch((()=>{u()}))})),h}function H(e,i,n){let s=Date.now(),a="";t&&(a="test/data/gameList.txt?v="+s),i[e]=[],n[e]=0;let r=0;f.request(a).then((t=>{i[e]=t||[],t.forEach((e=>{if(!e)return;e.isSub&&(r+=1);let t=$(e.group);if(globalThis.BASE_URL)if(e.baseURL){let t=globalThis.BASE_URL;"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),e.baseURL=t+e.baseURL}else e.baseURL=globalThis.BASE_URL;else{let t=globalThis.location.origin;e.baseURL?e.baseURL=t+e.baseURL:e.baseURL=globalThis.location.origin+"/"}t[e.id]=e})),n[e]=t.length-r}))}function A(e){const i=e.key||e.code;if(t)switch(i){case"r":case"R":if(U){globalThis.scene[U.id].reload({game:U.appConfig,group:U.group,id:U.id,tablekey:"abcd1234"})}}}function B(e){e.key||e.code}let S={oninit(){let e={},i={};t?H("test",e,i):(H("slot",e,i),H("video",e,i),H("game",e,i)),this.group=e,this.displayCount=i,globalThis.addEventListener("keydown",A),globalThis.addEventListener("keyup",B)},view(){let e=this;return t?f(".gameCardList",{style:{left:"0%",top:"0%",width:"100%",height:"100%"}},f(".",{style:{position:"absolute",left:"0%",top:"40%",width:"100%",height:"25%"}},"group zzzz",f(".layout",{style:{left:"0%",marginTop:"0px",width:25*e.displayCount.game+"%",height:"100%"}},e.group.test?e.group.test.map((e=>{if(!e||e.isSub)return f(".");let t=e.baseURL||"",s=e.images;return i.useAvif?s.v2&&(s=s.v2):s.v1&&(s=s.v1),f(".",{style:_},[f(I,{id:e.id,group:e.group,serve:{game:e.id,group:e.group},logo:t+s.logo,title:`${e.name[n()]}(${e.appConfig})`})])})):f(".")))):f(".gameCardList",{style:{left:"0%",top:"0%",width:"100%",height:"100%"}},f(".",{style:{position:"absolute",left:"0%",top:"65%",width:"100%",height:"25%",overflowX:"scroll"}},"group game",f(".layout",{style:{left:"0%",marginTop:"0px",width:25*e.displayCount.game+"%",height:"100%"}},e.group.game.map((e=>{if(!e||e.isSub)return f(".");let t=e.baseURL||"";return f(".",{style:{left:"0%",top:"0%",width:"90%",height:"100%"}},f(I,{id:e.id,group:"game",serve:{game:e.id,group:"game"},logo:t+e.images.logo,title:e.name[n()]}))})))),f(".",{style:{position:"absolute",left:"0%",top:"5%",width:"100%",height:"25%",overflowX:"scroll"}},"group slot",f(".layout",{style:{left:"0%",marginTop:"0px",width:25*e.displayCount.slot+"%",height:"100%"}},e.group.slot.map((e=>{if(!e&&e.isSub)return f(".");let t=e.baseURL||"";return f(".",{style:{left:"0%",top:"0%",width:"100%",height:"100%"}},[f(I,{id:e.id,group:"slot",serve:{game:e.id,group:"slot"},logo:t+e.images.logo,title:e.name[n()]})])})))),f(".",{style:{position:"absolute",left:"0%",top:"35%",width:"100%",height:"25%",overflowX:"scroll"}},"group video",f(".layout",{style:{left:"0%",marginTop:"0px",width:25*e.displayCount.video+"%",height:"100%"}},e.group.video.map((e=>{if(!e||e.isSub)return f(".");let t=e.baseURL||"";return f(".",{style:{left:"0%",top:"0%",width:"100%",height:"80%"}},[f(I,{id:e.id,group:"video",serve:{game:e.id,group:"video"},logo:t+e.images.logo,title:e.name[n()]})])})))))}},N={Android:()=>navigator.userAgent.match(/Android/i),BlackBerry:()=>navigator.userAgent.match(/BlackBerry/i),iOS:()=>navigator.userAgent.match(/iPhone|iPad|iPod/i),Opera:()=>navigator.userAgent.match(/Opera Mini/i),Windows:()=>navigator.userAgent.match(/IEMobile/i),any:()=>N.Android()||N.BlackBerry()||N.iOS()||N.Opera()||N.Windows()},V=null;function j(e){V=e}function D(e){V&&V.fix&&(globalThis.innerHeight>=e.screenHeight-V.fix.height?e.isFullscreen=!0:e.isFullscreen=!1)}let W={name:"chrome",0:{offset:{x:0,y:0,width:0,height:0},fix:{height:68}},90:{offset:{x:0,y:0,width:0,height:0},fix:{height:28}},"-90":{offset:{x:0,y:0,width:0,height:0},fix:{height:28}},270:{offset:{x:0,y:0,width:0,height:0},fix:{height:28}},180:{offset:{x:0,y:0,width:0,height:0},fix:{height:68}}};var G=Object.freeze({__proto__:null,checkFullscreen:function(e){D(e)},getCurrentValue:function(){return V},setCurrentValue:function(e){j(W[e])},value:W});let Y={name:"firefox",0:{offset:0,fix:{height:26}},90:{offset:0,fix:{height:26}},"-90":{offset:0,fix:{height:26}},270:{offset:0,fix:{height:26}},180:{offset:0,fix:{height:26}}};var q=Object.freeze({__proto__:null,checkFullscreen:function(e){D(e)},getCurrentValue:function(){return V},setCurrentValue:function(e){j(Y[e])},value:Y});let K={name:"opera",0:{offset:0,fix:{height:114}},90:{offset:0,fix:{height:72}},"-90":{offset:0,fix:{height:72}},270:{offset:0,fix:{height:72}},180:{offset:0,fix:{height:114}}};var X=Object.freeze({__proto__:null,checkFullscreen:function(e){D(e)},getCurrentValue:function(){return V},setCurrentValue:function(e){j(K[e])},value:K});let J={name:"uc",0:{offset:0,fix:{height:0}},90:{offset:0,fix:{height:0}},"-90":{offset:0,fix:{height:0}},270:{offset:0,fix:{height:0}},180:{offset:0,fix:{height:0}}};var Q=Object.freeze({__proto__:null,checkFullscreen:function(e){D(e)},getCurrentValue:function(){return V},setCurrentValue:function(e){j(J[e])},value:J});let Z={name:"baidu",0:{offset:{x:0,y:0,width:0,height:0},fix:{height:87}},90:{offset:0,fix:{height:87}},"-90":{offset:0,fix:{height:87}},270:{offset:0,fix:{height:87}},180:{offset:0,fix:{height:87}}};var ee=Object.freeze({__proto__:null,checkFullscreen:function(e){D(e)},getCurrentValue:function(){return V},setCurrentValue:function(e){j(Z[e])},value:Z});let te={name:"lieao",0:{offset:{x:0,y:0,width:0,height:0},fix:{height:0}},90:{offset:0,fix:{height:0}},"-90":{offset:0,fix:{height:0}},270:{offset:0,fix:{height:0}},180:{offset:0,fix:{height:0}}};var ie=Object.freeze({__proto__:null,checkFullscreen:function(e){D(e)},getCurrentValue:function(){return V},setCurrentValue:function(e){j(te[e])},value:te});let ne={name:"unknown",0:{offset:{x:0,y:0,width:0,height:0},fix:{height:0}},90:{offset:0,fix:{height:0}},"-90":{offset:0,fix:{height:0}},270:{offset:0,fix:{height:0}},180:{offset:0,fix:{height:0}}};var se=Object.freeze({__proto__:null,checkFullscreen:function(e){D(e)},getCurrentValue:function(){return V},setCurrentValue:function(e){j(ne[e])},value:ne});let ae={name:"chrome",0:{offset:{x:0,y:0,width:0,height:4},fix:{height:24}},90:{offset:{x:0,y:0,width:0,height:4},fix:{height:24}},"-90":{offset:{x:0,y:0,width:0,height:4},fix:{height:24}},180:{offset:{x:0,y:0,width:0,height:4},fix:{height:24}}},re=null;var oe=Object.freeze({__proto__:null,checkFullscreen:function(e){re&&re.fix&&(globalThis.innerHeight>=e.screenHeight-re.fix.height?e.isFullscreen=!0:e.isFullscreen=!1)},eventOrientation:function(e){let t=ae.state;switch(re=ae[e],j(re),e){case 0:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width;break;case-90:case 90:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!1,t.isLandscape=!0),screen.width<screen.height?(t.screenHeight=screen.width,t.screenWidth=screen.height):(t.screenHeight=screen.height,t.screenWidth=screen.width);break;case 180:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width}},getCurrentValue:function(){return V},value:ae});let le={name:"firefox",0:{offset:{x:0,y:0,width:0,height:4},fix:{height:40}},90:{offset:{x:0,y:0,width:0,height:4},fix:{height:8}},"-90":{offset:{x:0,y:0,width:0,height:4},fix:{height:8}},180:{offset:{x:0,y:0,width:0,height:4},fix:{height:40}}},ce=null;var ge=Object.freeze({__proto__:null,checkFullscreen:function(e){ce&&ce.fix&&(globalThis.innerHeight>=e.screenHeight-ce.fix.height?e.isFullscreen=!0:e.isFullscreen=!1)},eventOrientation:function(e){let t=le.state;switch(ce=le[e],j(ce),e){case 0:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width;break;case-90:case 90:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!1,t.isLandscape=!0),screen.width<screen.height?(t.screenHeight=screen.width,t.screenWidth=screen.height):(t.screenHeight=screen.height,t.screenWidth=screen.width);break;case 180:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width}globalThis.outerWidth<globalThis.innerWidth&&(globalThis.outerWidth=globalThis.innerWidth),globalThis.outerHeight<globalThis.innerHeight&&(globalThis.outerHeight=globalThis.innerHeight)},getCurrentValue:function(){return V},value:le});let he={name:"uc",0:{offset:{x:0,y:0,width:0,height:4},fix:{height:82}},90:{offset:{x:0,y:0,width:0,height:4},fix:{height:100}},"-90":{offset:{x:0,y:0,width:0,height:4},fix:{height:100}},180:{offset:{x:0,y:0,width:0,height:4},fix:{height:82}}},ue=null;var de=Object.freeze({__proto__:null,checkFullscreen:function(e){e.isFullscreen=!0},eventOrientation:function(e){let t=he.state;switch(ue=he[e],j(ue),e){case 0:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width;break;case-90:case 90:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!1,t.isLandscape=!0),screen.width<screen.height?(t.screenHeight=screen.width,t.screenWidth=screen.height):(t.screenHeight=screen.height,t.screenWidth=screen.width);break;case 180:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width}},getCurrentValue:function(){return V},value:he});let me={name:"safari",0:{offset:{x:0,y:0,width:0,height:4},fix:{height:32}},90:{offset:{x:0,y:0,width:0,height:4},fix:{height:16}},"-90":{offset:{x:0,y:0,width:0,height:4},fix:{height:16}},180:{offset:{x:0,y:0,width:0,height:4},fix:{height:32}}},pe=null;var fe=Object.freeze({__proto__:null,checkFullscreen:function(e){pe&&pe.fix&&(globalThis.innerHeight>=e.screenHeight-pe.fix.height?e.isFullscreen=!0:e.isFullscreen=!1)},eventOrientation:function(e){let t=me.state;switch(pe=me[e],j(pe),e){case 0:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width;break;case-90:case 90:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!1,t.isLandscape=!0),screen.width<screen.height?(t.screenHeight=screen.width,t.screenWidth=screen.height):(t.screenHeight=screen.height,t.screenWidth=screen.width);break;case 180:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width}},getCurrentValue:function(){return V},value:me});let be={name:"baidu",0:{offset:{x:0,y:0,width:0,height:4},fix:{height:0}},90:{offset:{x:0,y:0,width:0,height:4},fix:{height:0}},"-90":{offset:{x:0,y:0,width:0,height:4},fix:{height:0}},180:{offset:{x:0,y:0,width:0,height:4},fix:{height:0}}},we=null;var ve=Object.freeze({__proto__:null,checkFullscreen:function(e){we&&we.fix&&(globalThis.innerHeight>=e.screenHeight-we.fix.height?e.isFullscreen=!0:e.isFullscreen=!1)},eventOrientation:function(e){let t=be.state;switch(we=be[e],j(we),e){case 0:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width;break;case-90:case 90:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!1,t.isLandscape=!0),screen.width<screen.height?(t.screenHeight=screen.width,t.screenWidth=screen.height):(t.screenHeight=screen.height,t.screenWidth=screen.width);break;case 180:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width}},getCurrentValue:function(){return V},value:be});let ye={name:"liebao",0:{offset:{x:0,y:0,width:0,height:4},fix:{height:24}},90:{offset:{x:0,y:0,width:0,height:4},fix:{height:24}},"-90":{offset:{x:0,y:0,width:0,height:4},fix:{height:24}},180:{offset:{x:0,y:0,width:0,height:4},fix:{height:24}}},xe=null;var Le=Object.freeze({__proto__:null,checkFullscreen:function(e){xe&&xe.fix&&(globalThis.innerHeight>=e.screenHeight-xe.fix.height?e.isFullscreen=!0:e.isFullscreen=!1)},eventOrientation:function(e){let t=ye.state;switch(xe=ye[e],j(xe),e){case 0:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width;break;case-90:case 90:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!1,t.isLandscape=!0),screen.width<screen.height?(t.screenHeight=screen.width,t.screenWidth=screen.height):(t.screenHeight=screen.height,t.screenWidth=screen.width);break;case 180:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width}},getCurrentValue:function(){return V},value:ye});let Te={name:"unknown",0:{offset:{x:0,y:0,width:0,height:4},fix:{height:0}},90:{offset:{x:0,y:0,width:0,height:4},fix:{height:0}},"-90":{offset:{x:0,y:0,width:0,height:4},fix:{height:0}},180:{offset:{x:0,y:0,width:0,height:4},fix:{height:0}}},Ce=null;var Ee=Object.freeze({__proto__:null,checkFullscreen:function(e){Ce&&Ce.fix&&(globalThis.innerHeight>=e.screenHeight-Ce.fix.height?e.isFullscreen=!0:e.isFullscreen=!1),e.isFullscreen=!0},eventOrientation:function(e){let t=Te.state;switch(Ce=Te[e],j(Ce),e){case 0:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width;break;case-90:case 90:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!1,t.isLandscape=!0),screen.width<screen.height?(t.screenHeight=screen.width,t.screenWidth=screen.height):(t.screenHeight=screen.height,t.screenWidth=screen.width);break;case 180:(t.usePortrait||t.useLandscape)&&(t.isPortrait=!0,t.isLandscape=!1),t.screenHeight=screen.height,t.screenWidth=screen.width}},getCurrentValue:function(){return V},value:Te});function ke(e){let t=!1;return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?(t=!0,e&&(e.isFullscreen=!0)):(t=!1,e&&(e.isFullscreen=!1)),t}async function Re(e){if(!document.fullscreenEnabled)return Promise.reject();let t=!1;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(e&&(e.isFullscreen=!1),document.exitFullscreen?(await document.exitFullscreen(),t=!0):document.msExitFullscreen?(await document.msExitFullscreen(),t=!0):document.mozCancelFullScreen?(await document.mozCancelFullScreen(),t=!0):document.webkitExitFullscreen&&(await document.webkitExitFullscreen(),t=!0),t&&e&&(e.isFullscreen=!1)):(document.documentElement.requestFullscreen?(await document.documentElement.requestFullscreen(),t=!0):document.documentElement.msRequestFullscreen?(await document.documentElement.msRequestFullscreen(),t=!0):document.documentElement.mozRequestFullScreen?(await document.documentElement.mozRequestFullScreen(),t=!0):document.documentElement.webkitRequestFullscreen&&(await document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),t=!0),t&&(e&&(e.isFullscreen=!0),Pe.useOrientation&&globalThis.screen&&globalThis.screen.orientation&&globalThis.screen.orientation.lock&&await globalThis.screen.orientation.lock(Pe.orientation.name)))}let Oe=!0,Me=!1;let Ie={oninit(e){let t=this,i=e.attrs;t.onclick=i.onclick,t.style=i.style,t.config=i.config},onbeforeremove(){},view(){let e=this,t=e.config;return f(".pointer",{style:{width:"4%",height:"10%",borderRadius:"4px 8px 8px 4px",backgroundColor:"#000",opacity:.6,position:"absolute",left:e.style.left,top:e.style.top,zIndex:900},onclick(){t&&(t.isMenu=!0,t.visible=!1),e.onclick&&e.onclick()}},f.trust('<img src="data/sys/4021bb29611b24c4.svg" class="w-100 h-100 dropshadow">'))}},_e={oninit(e){let t=e.attrs,i=this;i.event=t.event,i.tray=t.tray,i.info=t.info,i.config=t.config,i.isLeave=!1,i.config||(i.config={isMenu:Me,visible:Oe,flags:{fullscreen:!0,lock:!0,sound:!0,music:!0}}),i.config.flags||(i.config.flags={}),i.info||(i.info={logo:"logo.png",gameName:"test game",version:"0.0.0",mode:" test mode",token:"token"}),i.tray||(i.tray={state:{visible:!0},sound:{isMute:!1},music:{isMute:!1},screen:{isAutoScale:!0,isLock:!1},isLock:!1,isFullscreen:!1},Object.defineProperty(i.tray,"visible",{get:()=>i.tray.state.visible,set(e){i.tray.state.visible=e}}))},onbeforeremove:e=>(["animate__fadeOutLeft","animate__animated"].forEach((t=>{e.dom.classList.add(t)})),new Promise((e=>{b.updateManager.setTimeout((()=>{e()}),.4)}))),onremove(){},view(){let t=this,n=t.tray,s=t.event,a=t.info,r=t.config,o=r.flags,l=i.menu||[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0];return f(".animate__fadeInLeft animate__animated",{onclick(){t.isLeave?(r.isMenu=!1,r.visible=!1,n.visible=!1):(r.visible=!1,n.visible=!0)},style:{zIndex:900,position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}},f(".pv2.ph2.bg-black.[id='panel']",[f(".fl.bb.b--gray.mb2.dib.pb2.mb2.w-100.rwdPanelHeader",[f("table.pa2.ml4.dib.br2.bg-black.white.rwdAppInfo",f("tbody.rwd-lh",[f("tr",[f("td",e("gameName")),f("td"," : "),f("td.blue",a.gameName)]),f("tr",[f("td",e("version")),f("td"," : "),f("td.blue",a.version)]),l[8]?f("tr",[f("td",e("gameMode")),f("td"," : "),f("td.blue",a.mode)]):null]))]),l[0]&&o.fullscreen&&!Pe.ios?f(".",[f(".fl.w-70.pa1.ma1.rwdOpt",f(".no-underline.near-white.inline-flex",[f("img.dib.fl.mv1.rwdOptIcon.dropshadow",{alt:"FULL SCREEN",src:"data/sys/f512613ddcb62054.png"}),f(".ml3.white.mv3.f4.rwdPanelFont",e("fullscreen"))])),f(".fr.w-20.pt2.mv2.mr2.rwdToggle",{onclick(){n.isFullscreen=!n.isFullscreen,f.redraw(),Re(n).then((()=>{s&&s.fullscreen&&s.fullscreen(n.isFullscreen)}))}},f("label.switch",[f("input[name='toggle'][type='checkbox'][value='fullscreen']",{disabled:!0,checked:n.isFullscreen}),f("span.slider.round")]))]):f("."),l[1]&&o.lock?f(".",[f(".fl.w-70.pa1.ma1.rwdOpt",f(".no-underline.near-white.inline-flex",[f("img.dib.fl.mv1.rwdOptIcon.dropshadow",{alt:"LOCK SCALE",src:"data/sys/8920df5ffd5c25b0.png"}),f(".ml3.white.mv3.f4.rwdPanelFont",e("lock"))])),f(".fr.w-20.pt2.mv2.mr2.rwdToggle",{onclick(){n.isLock=!n.isLock,n.update&&n.update(n),f.redraw(),s&&s.lock&&s.lock(n.isLock)}},f("label.switch",[f("input[name='toggle'][type='checkbox'][value='lock']",{disabled:!0,checked:n.isLock}),f("span.slider.round")]))]):f("."),l[2]&&o.music?f(".",[f(".fl.w-70.pa1.ma1.rwdOpt",f(".no-underline.near-white.inline-flex",[f("img.h-100.dib.fl.mv1.rwdOptIcon.dropshadow[alt='MUSIC'][src='data/sys/ddb7103e5eca70e6.png']"),f(".ml3.white.mv3.f4.rwdPanelFont",e("music"))])),f(".fr.w-20.pt2.mv2.mr2.rwdToggle",{onclick(){n.music.isMute=!n.music.isMute,f.redraw(),s&&s.music&&s.music(n.music)}},f("label.switch",[f("input[name='toggle'][type='checkbox'][value='music']",{disabled:!0,checked:!n.music.isMute}),f("span.slider.round")]))]):f("."),l[3]&&o.sound?f(".",[f(".fl.w-70.pa1.ma1.rwdOpt",f(".no-underline.near-white.inline-flex",[f("img.dib.fl.mv1.rwdOptIcon.dropshadow[alt='SOUND'][src='data/sys/ddb7103e5eca70e6.png']"),f(".ml3.white.mv3.f4.rwdPanelFont",e("sound"))])),f(".fr.w-20.pt2.mv2.mr2.rwdToggle",f("label.switch",[f("input[name='toggle'][type='checkbox'][value='sound']",{checked:!n.sound.isMute,onclick(){n.sound.isMute=!n.sound.isMute,s&&s.sound&&s.sound(n.sound)}}),f("span.slider.round")]))]):f("."),l[4]?f(".fl.w-100.pa2.pt3.bt.b--gray.mt2.rwdBtn",{onclick(){Pe.useFocus=!0}},f(".w-100 no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma1 tc br1 pa1 border-box pointer",[f("img.dib h2 w2[src='data/sys/35b95e6d1d3ebf48.png']"),f(".w-100.f3.white.mv1.dib.noselect.rwdPanelFont",e("history"))])):f("."),l[5]?f(".fl.w-100.pa2",{onclick(){Pe.useFocus=!0}},f(".w-100 no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma1 tc br1 pa1 border-box pointer",[f("img.dib h2 w2[src='data/sys/2357769f78f010b1.png']"),f(".w-100.f3.white.mv1.dib.noselect",e("deposit"))])):f("."),l[6]?f(".fl.w-100.pa2",{onclick(){globalThis.Howler&&(globalThis.Howler.mute(!0),globalThis.Howler.unload()),Pe.useFocus=!0}},f(".w-100 no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma1 tc br1 pa1 border-box pointer",[f("img.dib h2 w2[src='data/sys/94615eed5b8c0616.png']"),f(".w-100.f3.white.mv1.dib.noselect",e("back"))])):f("."),l[7]?f(".fl.w-100.pa2",{onclick(){if(Pe.useFocus=!0,t.isLeave=!0,a.iframe){let e=a.iframe.contentDocument||a.iframe.contentglobalThis.document;e?(e.open(),e.write(""),e.close()):a.iframe.srcdoc="about:blank"}globalThis.Howler&&(globalThis.Howler.mute(!0),globalThis.Howler.unload())}},f(".w-100 no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma1 tc br1 pa1 border-box pointer",[f("img.dib h2 w2[src='data/sys/fe342b264ea95dbb.png']"),f(".w-100.f3.white.mv1.dib.noselect",e("lobby"))])):f("."),f(".")]))}},Pe={},Fe={resizeTimer:null,timer:null,eventDelay:260},Ue=null,$e={name:null,angle:0,isTrigger:!1},ze=null;function He(e){switch(ze&&ze.setCurrentValue&&ze.setCurrentValue(e),e){case 0:(Pe.usePortrait||Pe.useLandscape)&&(Pe.isPortrait=!0,Pe.isLandscape=!1),Pe.screenHeight=screen.height,Pe.screenWidth=screen.width;break;case 270:case-90:case-270:case 90:(Pe.usePortrait||Pe.useLandscape)&&(Pe.isPortrait=!1,Pe.isLandscape=!0),screen.width<screen.height?(Pe.screenHeight=screen.width,Pe.screenWidth=screen.height):(Pe.screenHeight=screen.height,Pe.screenWidth=screen.width);break;case-180:case 180:(Pe.usePortrait||Pe.useLandscape)&&(Pe.isPortrait=!0,Pe.isLandscape=!1),Pe.screenHeight=screen.height,Pe.screenWidth=screen.width}globalThis.parent===window&&globalThis.scrollTo(0,Pe.currentY)}function Ae(){Pe.isPortrait=!1,Pe.isLandscape=!1;let e=0;e=window.matchMedia("(orientation: portrait)").matches?0:90,0===e&&(e=globalThis.screen.orientation&&"number"==typeof globalThis.screen.orientation.angle?globalThis.screen.orientation.angle:parseInt(globalThis.orientation)),$e.angle=e,Ue?Ue(e):ze&&ze.eventOrientation?ze.eventOrientation(e):He(e),globalThis.parent===window&&globalThis.scrollTo(0,Pe.currentY)}function Be(e){Fe.timer&&(b.updateManager.remove(Fe.timer),Fe.timer=null),$e.isTrigger=!0,f.redraw(),Fe.timer=b.updateManager.setTimeout((()=>{$e.isTrigger=!1,Ae(),Ve()}),.001*Fe.eventDelay)}function Se(e){if(Pe.isMobile&&!e.isChild&&ze&&ze.getCurrentValue){let t=ze.getCurrentValue();if(t){let i=t.offset;e.left=0,e.top=0,e.width=globalThis.innerWidth,e.height=globalThis.innerHeight,"number"==typeof i?e.height=globalThis.innerHeight-i:i&&("number"==typeof i.x&&(e.left=i.x),"number"==typeof i.y&&(e.top=i.y),"number"==typeof i.width&&(e.width=globalThis.innerWidth-i.width),"number"==typeof i.height&&(e.height=globalThis.innerHeight-i.height))}else e.left=0,e.top=0,e.width=globalThis.innerWidth,e.height=globalThis.innerHeight;e.left+="px",e.top+="px",e.width+="px",e.height+="px"}}function Ne(e){let t=e.game,i={x:1,y:1},n=screen.width,s=screen.height;Pe.isMobile?(n=globalThis.innerWidth,s=globalThis.innerHeight,Pe.useFullscreen||(n=globalThis.innerWidth,s=globalThis.innerHeight),Pe.ios&&(s=globalThis.innerHeight,n=globalThis.innerWidth)):(n=globalThis.innerWidth,s=globalThis.innerHeight),t.portrait&&t.landscape&&(n>s?(t.width=t.landscape.width||512,t.height=t.landscape.height||512):(t.width=t.portrait.width||512,t.height=t.portrait.height||512)),e.fix&&(n=parseInt(e.fix.width),s=parseInt(e.fix.height));let a={x:0,y:0};e.left=0,e.top=0;let r=e.reference;r&&(a.x=r.left*n,a.y=r.top*s,n*=r.width,s*=r.height),n-t.width<0?(e.width=n,i.x=n/t.width):e.width=t.width,s-t.height<0?(e.height=s,i.y=s/t.height):e.height=t.height,i.x<i.y?e.height=t.height*i.x:i.x>i.y&&(e.width=t.width*i.y);let o=e.anchor;if(o){let t=(n-e.width)*(o.x??.5),i=(s-e.height)*(o.y??.5);e.left=a.x+t,e.top=a.y+i}if(e.useCenter){let t=0,i=0;"boolean"==typeof e.useCenter?(i=.5*(s-e.height),i<0&&(i=0),t=.5*(n-e.width),t<0&&(t=0)):(e.useCenter.vertical&&(i=.5*(s-e.height),i<0&&(i=0)),(e.useCenter.horizontal||e.useCenter.left)&&(t=.5*(n-e.width),t<0&&(t=0))),e.left=a.x+t,e.top=a.y+i}e.absPos&&("number"==typeof e.absPos.top?e.top=e.absPos.top:"number"==typeof e.absPos.bottom&&(e.top=s+e.absPos.bottom),"number"==typeof e.absPos.left?e.left=e.absPos.left:"number"==typeof e.absPos.right&&(e.left=n+e.absPos.right)),t.eventResize&&t.eventResize({left:e.left,top:e.top,width:e.width,height:e.height}),e.eventResize&&e.eventResize({width:globalThis.innerWidth,height:globalThis.innerHeight}),e.left+="px",e.top+="px",e.width+="px",e.height+="px"}function Ve(e){if(!$e.isTrigger&&!Pe.disableResize){if(!e)return!!$e.isTrigger||void(Fe.resizeTimer||(Pe.isResize=!0,f.redraw(),Fe.resizeTimer=b.updateManager.setTimeout((()=>{b.updateManager.remove(Fe.resizeTimer),Fe.resizeTimer=null,t()}),.3)));t()}function t(){Pe.isMobile&&globalThis.parent===window&&globalThis.scrollTo(0,Pe.currentY),b.updateManager.setTimeout((()=>{ze&&ze.checkFullscreen&&Pe.useFullscreen&&ze.checkFullscreen(Pe);let e=globalThis.scene;if(Pe.settingList.forEach((t=>{if(t){if(!t.isLock)return Se(t),f.redraw(),!0;if(Ne(t),e){let i=e[t.id];if(i){let e=i.localEvent;if(e&&e.resize){let i={isMobile:Pe.isMobile};i.width=globalThis.innerWidth,i.height=globalThis.innerHeight,i.setting=t,e.resize(i)}}}f.redraw()}})),e){Object.getOwnPropertyNames(e).forEach((t=>{let i=e[t];if(i){let e=i.localEvent;if(e&&e.resize){let t={isMobile:Pe.isMobile};t.width=globalThis.innerWidth,t.height=globalThis.innerHeight,4!==i.state&&5!==i.state||e.resize(t)}}}))}Pe.isResize=!1,f.redraw()}),.01)}}function je(e){if(e?.index>=0)return-1;let t=-1;for(let i=0;i<Pe.settingList.length;i+=1){Pe.settingList[i]||(t=i,Pe.settingList[i]=e)}return t<0&&(t=Pe.settingList.length,Pe.settingList.push(e)),e.isLock&&Ne(e),e.index=t,t}function De(e){if(e?.index>=0){let t=e.index;t<Pe.settingList.length&&(Pe.settingList[t]=null),delete e.index}}function We(e){Pe.disableResize=e}function Ge(){Pe.settingList=[]}Pe.ios=!1,Pe.useOrientation=!1,Pe.usePortrait=!1,Pe.useLandscape=!1,Pe.isMobile=!1,Pe.mobileReady=null,Pe.useFullscreen=!1,Pe.isFullscreen=!1,Pe.isPortrait=!1,Pe.isLandscape=!1,Pe.isTouchOnce=!1,Pe.isResize=!1,Pe.currentY=0,Pe.screenWidth=screen.width,Pe.screenHeight=screen.height,Pe.screenUnit="px",Pe.orientation=$e,Pe.isTouchDown=!1,Pe.useFocus=!1,Pe.disableResize=!1,Pe.settingList=[];let Ye=!1;async function qe(e){if(Pe.currentY=0,document){let e=globalThis.scene;document.onfullscreenchange=document.onwebkitfullscreenchange=()=>{Pe.settingList.forEach((t=>{if(t&&e){let i=e[t.id];if(i){let e=i.game&&i.game.sysTray;ke(e);let t=i.localEvent;if(t&&t.fullscreen){let i=e&&e.isFullscreen;t.fullscreen(i)}}}})),f.redraw()},document.onfullscreenerror=document.onwebkitfullscreenerror=()=>{Pe.settingList.forEach((t=>{if(t&&e){let i=e[t.id];if(i){let e=i.game&&i.game.sysTray;ke(e);let t=i.localEvent;if(t&&t.fullscreen){let i=e&&e.isFullscreen;t.fullscreen(i)}}}})),f.redraw()}}if(!i.isCheckGameCDN&&N.any()?(Ye||(screen&&screen.orientation&&screen.orientation.addEventListener?screen.orientation.addEventListener("change",Be):globalThis.addEventListener("orientationchange",Be)),Pe.isMobile=!0,Ue=He,N.iOS()?(globalThis.parent===window&&(Pe.currentY=200),Pe.ios=!0,Ue=null):N.Android()&&(globalThis.parent===window&&(Pe.currentY=200),Ue=null)):Pe.isMobile=!1,e&&(Pe.useOrientation=!1,Pe.usePortrait=!1,Pe.useLandscape=!1,Pe.isMobile&&("string"==typeof e.orientation&&("portrait"===e.orientation?(Pe.usePortrait=!0,Pe.orientation.name="portrait"):(Pe.useLandscape=!0,Pe.orientation.name="landscape"),Pe.useOrientation=!0),ze=null,Pe.useFullscreen=!1,N.iOS()?navigator.userAgent.match(/baidu/i)?(ze=ve,Pe.screenUnit="px",Pe.useFullscreen=!1):navigator.userAgent.match(/CriOS/i)?(ze=oe,Pe.screenUnit="px",Pe.useFullscreen=!1):navigator.userAgent.match(/LieBao|ACHEETAHI/i)?(ze=Le,Pe.screenUnit="px",Pe.useFullscreen=!1):navigator.userAgent.match(/FxiOS/i)?(ze=ge,Pe.screenUnit="px",Pe.useFullscreen=!1):navigator.userAgent.match(/Safari/i)?(ze=fe,Pe.screenUnit="px",Pe.useFullscreen=!1):navigator.userAgent.match(/UCB/i)?(ze=de,Pe.screenUnit="px",Pe.useFullscreen=!1):ze=Ee:N.Android()&&(navigator.userAgent.match(/OPR/i)?(ze=X,Pe.screenUnit="px",Pe.useFullscreen=!1,navigator.userAgent.match(/baidu/i)?ze=ee:navigator.userAgent.match(/LieBao|ACHEETAHI/i)&&(ze=ie,Pe.screenUnit="px",Pe.useFullscreen=!1)):navigator.userAgent.match(/baidu/i)?(ze=ee,Pe.screenUnit="px",Pe.useFullscreen=!1):navigator.userAgent.match(/LieBao|ACHEETAHI/i)?(ze=ie,Pe.screenUnit="px",Pe.useFullscreen=!1):navigator.userAgent.match(/Firefox/i)?(ze=q,Pe.screenUnit="px",Pe.useFullscreen=!1):navigator.userAgent.match(/UCB/i)?(ze=Q,Pe.screenUnit="px",Pe.useFullscreen=!1):navigator.userAgent.match(/Chrome/i)?(Pe.useFullscreen=!1,Pe.screenUnit="px",ze=G):ze=se),navigator.userAgent.match(/(UBiOS|Pad|Tablet|KFAUW|Mb2345|ME173X|NRD90M|VIE|N2G47H)/i)&&(Pe.useFullscreen=!1,Pe.screenUnit="px"),ze&&(ze.value.state=Pe),Ye||globalThis.addEventListener("focus",(()=>{Pe.useFocus&&(Pe.isTouchOnce=!0,Pe.useFocus=!1,Ve(!0))}),!0),Ae(),Ve(!0),Pe.settingList.forEach((e=>{if(e)return e.isLock?void Ne(e):(Se(e),!0)})),Pe.isFullscreen=!0,Pe.isTouchDown=!1,Pe.isTouchOnce=!0)),i.mobileMode){let e=i.mobileMode;parseInt(e)>0&&(Pe.isFullscreen=!0,Pe.isTouchDown=!1,Pe.isTouchOnce=!0)}document.body.onscroll=()=>{!Pe.isMobile||Pe.orientation.isTrigger||Pe.isResize||Pe.disableResize||globalThis.parent===window&&Pe.isMobile&&(Pe.currentY=globalThis.pageYOffset,globalThis.scrollTo(0,Pe.currentY),f.redraw())},Ye||globalThis.addEventListener("resize",Ve),Ye=!0}var Ke=Object.freeze({__proto__:null,__unload:()=>{screen&&screen.orientation&&screen.orientation.removeEventListener?screen.orientation.removeEventListener("change",Be):globalThis.removeEventListener("orientationchange",Be),globalThis.removeEventListener("resize",Ve)},addSetting:je,decSetting:De,eventResize:Ve,init:qe,orientationChangeHandler:Be,removeAllSetting:Ge,setDisableResize:We,state:Pe});let Xe={oninit(e){let t=e.attrs;this.url=t.url,this.manager=t.manager,this.setting={id:"children",isLock:!1,useCenter:!1,left:"0%",top:"0%",width:"100%",height:"100%",game:{width:1024,height:1024},reference:{left:0,top:0,width:1,height:1}},je(this.setting)},oncreate(e){let t=e.instance.children[0].dom;b.updateManager.setTimeout((()=>{We(!0),t.focus()}),.2)},view(){let t=this,i=t.setting;return f(".rwdPanelHeader",{style:{position:"absolute",left:i.left,top:i.top,backgroundColor:"rgba(0,0,0,1)",zIndex:950,opacity:1,width:i.width,height:i.height}},f("iframe",{src:t.url,scrolling:"yes",frameborder:0,style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}}),f(".fl.tc.pv4.bg-black.hover-bg-gray",{style:{position:"absolute",left:"5%",top:"0%",width:"90%",height:"10%",opacity:.75,cursor:"pointer"},onclick(){We(!1),t.manager.childrenVisible=!1,t.url=""}},f(".inline-flex.white.border-box.pointer",`${e("close")}`)))}},Je={engine:null},Qe={engine:null},Ze={engine:null},et=!1;async function tt(e){return new Promise(((t,i)=>{let n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=()=>{t()},n.onerror=()=>{i()},document.body.appendChild(n)}))}let it=!1;async function nt(e){let t,n,s,a,r={},o=e;return e.useModule?(s=await import("pixi.js"),a=await import("pixi-spine")):(await async function(){if(it)return;let e,t="/dependence/";i.selectCDN&&(t=`${globalThis.BASE_URL}dependence/`),e=["pixi/pixi.min.6.5.9.js"];let n=[];for(let i=0;i<e.length;i++){let s=tt(t+e[i]);n.push(s)}await Promise.all(n);let s=["pixi/pixi-spine.2.0.5.js"];n=[];for(let e=0;e<s.length;e++){let i=tt(t+s[e]);n.push(i)}await Promise.all(n),it=!0}(),s=globalThis.PIXI,a=globalThis.PIXI.spine),n=s.Renderer?new s.Renderer(o):new s.WebGLRenderer(o),t=new s.Container,r.stage=t,r.overlay=new s.Container,r.foreground=new s.Container,r.main=new s.Container,r.background=new s.Container,t.addChildAt(r.overlay,0),t.addChildAt(r.foreground,0),t.addChildAt(r.main,0),t.addChildAt(r.background,0),{PIXI:s,spine:a,renderer:n,stage:t,layer:r,render(){n.render(t)}}}const st=0,at=6,rt=1,ot=3,lt=4,ct=5;let gt,ht={oninit(){this.options={}},async oncreate(s){let a=this;a.isIframeLoaded=!1,a.isIframeInit=!1;let h,u=Math.round(performance.now());a.timestamp=u,a.checkItem=null;let d={isFirstTime:!0,useVideo:!1,isCheckData:!1,isChild:!1,isGame:!0,isCreate:!1,isBusy:!0,rendered:null,disable:!0,sysTray:null,trayVisible:!1,childrenVisible:!1,currentUrl:"",useCenter:!0,position:"absolute",left:"25%",top:"25%",width:"50%",height:"50%"},m={state:{visible:!0},sound:{isMute:!1},music:{isMute:!1},screen:{isAutoScale:!0,isLock:!1},isLock:!1,isFullscreen:!1};Object.prototype.hasOwnProperty.call(m,"visible")||Object.defineProperty(m,"visible",{get:()=>m.state.visible,set(e){d.mode!==r.DEMO&&(m.state.visible=e,d.sysTray&&(e?(d.sysTray.isMenu=!1,d.sysTray.visible=!0):(d.sysTray.isMenu=!1,d.sysTray.visible=!1),f.redraw()))}});let p=null,v=null,y=a.options,x=s.attrs;if(a.currentBaseURL=null,x&&(p=x.gameManager,a.checkItem=x.checkItem,a.currentBaseURL=x.currentBaseURL,d.left=x.left||"25%",d.top=x.top||"25%",d.width=x.width||"50%",d.height=x.height||"50%",d.reference=x.reference,d.fix=x.fix,d.isChild=x.isChild,d.isCheckData=x.isCheckData,x.sysTray?d.sysTray={visible:!0,isMenu:!1,flags:x.sysTray.flags,style:{left:x.sysTray.left||"0px",top:x.sysTray.top||"0px"}}:d.sysTray=null,h=x.config,a.ctrlEvent=x.ctrlEvent),m.visible=!1,!h)return;let L=n();d.isCreate=h.isCreate,d.templateVersion=h.scene.templateVersion,d.id=h.id,d.mode=h.mode,d.name=h.scene.name[L],d.group=h.scene.group||"game",d.appName=h.scene.app,d.appHash=h.scene.appHash,d.appConfig=h.scene.appConfig,d.devMode=h.scene.devMode,d.dependence=h.scene.dependence,d.background=null,d.backgroundCSS=null,a.appTimeout=t?null:b.updateManager.setTimeout((()=>{y.initGame=null,a.appTimeout=null,f.redraw(),b.updateManager.setTimeout((()=>{i.requestReload=!1,i.isReload=!0,o.reload({url:a.currentBaseURL,group:d.group,game:d.appConfig})}),.1)}),10);let T=`${d.group}${d.appConfig}`,C={category:"遊戲程式 "+(a.currentBaseURL||"主網址"),getLabel:()=>T},E={category:"遊戲場景 "+(a.currentBaseURL||"主網址"),getLabel:()=>T},k={category:"建立遊戲 "+(a.currentBaseURL||"主網址"),getLabel:()=>T};i.isCheckGameCDN||(l.loadBegin(k),l.loadBegin(C)),d.anim={element:null,isPlay:!1},d.display="inline",d.opacity=0,d.zIndex=1,x.updateStyle&&x.updateStyle(d);let R=h.scene.images;i.useAvif?R.v2&&(R=R.v2):R.v1&&(R=R.v1),d.game={id:h.id,group:h.scene.group,mode:h.mode,decimal:h.decimal,name:d.name,logo:R&&R.logo,theOther:h.scene.theOther,version:h.scene.version,baseURL:h.scene.baseURL||"",langID:L},R&&Object.prototype.hasOwnProperty.call(R,"useBackground")&&R.background&&(d.isCheckData||(d.background=`${d.game.baseURL}${R.background}`),"string"==typeof R.useBackground?d.backgroundCSS=`${R.useBackground}`:(R.useBackground,d.backgroundCSS=null)),h.scene.screen&&(d.isLock=h.scene.screen.isLock,d.game.width=h.scene.screen.width||640,d.game.height=h.scene.screen.height||960,d.game.portrait=h.scene.screen.portrait,d.game.landscape=h.scene.screen.landscape,Pe.isMobile,m.isLock=d.isLock),d.images=R,d.isCheckData||je(d);let O=null,M=h.loadingEvent,I=o.getManager(),_=null,P=I.scene[d.id]={templateVersion:d.templateVersion,state:st,event:{create:null,play:null,pause:null,enter:null,leave:null,focus:null,blur:null,lock:null,fullscreen:null,resize:null,music:null,sound:null},info:{isChild:d.isChild,baseURL:d.game.baseURL||"",id:d.game.id,name:d.game.name,group:d.game.group,theOther:d.game.theOther,width:d.game.width,height:d.game.height,decimal:d.game.decimal,mode:d.game.mode,langID:d.game.langID},gamecard:h.scene,loadingEvent:{title:d.name,start(){i.isCheckGameCDN||l.loadBegin(E),M.start&&M.start()},resBegin(e){M.resBegin&&M.resBegin(e)},resEnd(e){M.resEnd&&M.resEnd(e)},sceneResBegin(e){M.sceneResBegin&&M.sceneResBegin(e)},sceneResLoading(e){M.sceneResLoading&&M.sceneResLoading(e)},sceneResEnd(e){M.sceneResEnd&&M.sceneResEnd(e)},finish(){P.state=lt,i.isCheckGameCDN||(l.loadEnd(E),l.log({label:T,category:"遊戲場景 "+(a.currentBaseURL||"主網址")}),l.loadEnd(k)),M.finish&&M.finish(P)}},callWeb(e){"string"==typeof e?I.document&&I.document.location&&I.document.location.replace?I.document.location.replace(e||"about:blank"):I.location.href=e||"about:blank":o.showInfo(e)},open(e){d.childrenVisible=!0,d.currentUrl=e,f.redraw()},setDisableResize(e){We(e)},reload(e){if(i.isReload)return;o.hideInfo(),i.isReload=!0;let t=e;t||(t={game:d.appConfig,group:d.group}),P.game.stop(),P.game.reset();p.clean(),b.updateManager.setTimeout((()=>{for(let e=0;e<globalThis.frames.length;e+=1){let t=globalThis.frames[e];if(t){let e=t.document;e&&(e.documentElement.innerHTML="")}}y.initGame=null,P.game=null,a.ctrlEvent&&a.ctrlEvent.reload&&a.ctrlEvent.reload(),f.redraw(),b.updateManager.setTimeout((()=>{p.reload().then((()=>{z(t.game,t.group,a.currentBaseURL,t.version).then((i=>{i&&i.gameCard&&(i.gameCard.reloadConfig=e,p.init({gameCard:i.gameCard,id:t.game,group:t.group}))}))}))}),.01)}),.05)},leave(e){},setMode(t){let i=r;c.mode=t,c.mode===i.REAL?y.info.mode=e("gameModeReal"):y.info.mode=e("gameModeDemo"),f.redraw()},async fullscreen(e){if(e||!ke())try{return await Re(m)}catch(e){}},ready(e){if(!P.game&&e&&(P.game=e),a.appTimeout&&(b.updateManager.remove(a.appTimeout),a.appTimeout=null),i.isCheckGameCDN||(l.loadEnd(C),l.log({label:T,category:"遊戲程式 "+(a.currentBaseURL||"主網址")})),a.checkItem){let e=a.checkItem,t=Math.round(performance.now());e.timeInit=t-a.timestamp,a.timestamp=t,e.state="app",e.timeReady=t-e.timestamp,e.timestamp=t,f.redraw(),e.ready&&e.ready(e)}_(P.game).then((()=>{if(P.game){let e={error(e){l.error({label:T,category:e})},log(e){"string"==typeof e?l.log({label:T,category:e}):e&&(e.label=T,l.log(e))},serviceBegin(e){if(e){if(e.getLabel=()=>T,!e.category)return;l.serviceBegin(e)}},serviceEnd(e){if(e){if(e.getLabel=()=>T,!e.category)return;l.serviceEnd(e)}},loadBegin(e){if(e){if(e.getLabel=()=>T,!e.category)return;l.loadBegin(e)}},loadEnd(e){if(e){if(e.getLabel=()=>T,!e.category)return;l.loadEnd(e)}}};P.game.report=e,P.game.localforage=w}d.isBusy=!1,d.isCreate&&P.event&&P.event.create?(t&&(P.info.console=console),P.info.setting=i,P.event.create(P.info),P.state=rt):P.state=ot}))},graphReady(){P.ready()},setOverviewVisible(e){P.gamecard.manual&&P.gamecard.manual.overview&&(p.currentGame.overview.visible=e,f.redraw())},setEvent(e){let t=P.event;t.create=e.create||t.create,t.play=e.play||t.play,t.pause=e.pause||t.pause,t.enter=e.enter||t.enter,t.leave=e.leave||t.leave,t.focus=e.focus||t.focus,t.blur=e.blur||t.blur,t.lock=e.lock||t.lock,t.fullscreen=e.fullscreen||t.fullscreen,t.resize=e.resize||t.resize,t.music=e.music||t.music,t.sound=e.sound||t.sound}};P.state=at;let F=!1,$=null,H=null,A=null;async function B(e){if($=`${i.projectURL}${d.group}/${d.appConfig}/`,H=`${d.group}/${d.appConfig}`,A={imports:{},scopes:{}},e)try{A.imports.nuts=import.meta.resolve("nuts"),A.imports.mithril=import.meta.resolve("mithril"),A.imports.tweenjs=import.meta.resolve("tweenjs"),A.imports["pixi.js"]=import.meta.resolve("pixi.js"),A.imports["pixi-spine"]=import.meta.resolve("pixi-spine"),A.imports["apng-js"]=import.meta.resolve("apng-js"),A.imports["video/domains"]=import.meta.resolve("video/domains"),A.imports["video/photos"]=import.meta.resolve("video/photos")}catch(e){}if(t){let e=await import("js-yaml");e.default&&(e=e.default);let t=`${$}system.set.yml`,n=await fetch(t);if(n.ok){let t=await n.text(),s=e.load(t);s.package.skipRollup&&(F=!0);let a={};if(F){A.imports[H]=`${d.game.baseURL}${s.package.main}`,Object.getOwnPropertyNames(s.config.paths).forEach((e=>{let t=s.config.paths[e];"/"===t[0]?a[e]=t:a[e]=`${i.projectURL}${t}`}))}if(s.config.importmap){Object.getOwnPropertyNames(s.config.importmap).forEach((e=>{let t=s.config.importmap[e];"/"===t[0]?a[e]=t:a[e]=`${i.projectURL}${t}`}))}A.scopes[$]=a}}}_=async e=>{let n=globalThis.location.origin;a.currentBaseURL&&(n=a.currentBaseURL),d.game.baseURL.length>0&&(n=d.game.baseURL);let s=n;s.length>0&&"/"===s[s.length-1]&&(s=s.substring(0,s.length-1));let r=d.appName;if("object"==typeof r&&(r=d.appName[d.game.langID],r||(r=d.appName[g.EN_US])),r){let e=r.split("/"),t=e.length-1;s=t>2?`${s}/${e[t-1]}/${e[t]}`:`${s}/${r}`}if(await B(),"game.6.0"===d.templateVersion){if(e.getRenderer){let t=P.gamecard.pixiConfig;e.getRenderer().resize(t.width,t.height)}let n;if(e.layer.overlay.removeChildren(),e.layer.foreground.removeChildren(),e.layer.main.removeChildren(),e.layer.background.removeChildren(),e.play(),e.scene=P,t&&A&&importShim){importShim.addImportMap(A);importShim.getImportMap()}if(t&&F)try{let e=import.meta.resolve(H);n=await import(e)}catch(e){n=await import(s)}else n=await import(s);let a=await n.scene.init({setting:i,baseURL:P.info.baseURL,isChild:P.info.isChild,langID:P.info.langID,gamecard:P.gamecard,game:e,nuts:b}),r={create(t){I.lobby&&(e.currentUser=I.lobby.currentUser,e.command=I.lobby.net.gameCommand,e.lobby={setEvent:I.lobby.setEvent,setCommand:I.lobby.net.setLobbyCommand,CMD:I.lobby.net.CMD}),a.create&&(t.game=e,t.setting=i,a.create(t))},play(t){e.play(),a.play&&(t.game=e,t.setting=i,a.play(t))},pause(t){e.pause(),a.pause&&(t.game=e,t.setting=i,a.pause(t))},enter(t){a.enter&&(t.game=e,t.setting=i,a.enter(t))},leave(t){a.leave&&(t.game=e,t.setting=i,a.leave(t))},focus(){a.focus&&a.focus()},blur(){a.blur&&a.blur()},lock(e){a.lock&&a.lock(e)},fullscreen(e){a.fullscreen&&a.fullscreen(e)},resize(e){a.resize&&a.resize(e)},music(e){a.music&&a.music(e)},sound(e){a.sound&&a.sound(e)}};P.setEvent(r),P.game=e}};let S={isActive:!0,create(e){e.isCreate&&P.event?.create&&(t&&(P.info.console=console),P.info.setting=i,P.event.create(P.info),P.state=rt)},async enter(e){let t=e||{};t.from||(t.from=P.info.id),t.id||(t.id=d.game.id),t.game||(t.game=P.game),i.isInGame=!0,Pe.isMobile&&(d.isChild||globalThis.scrollTo(0,Pe.currentY)),d.isFirstTime&&(d.isFirstTime=!1),P.game&&(I.lobby&&(P.game.command=I.lobby.net.gameCommand,P.game.table=I.lobby.table[t.id],P.game.currentUser=I.lobby.currentUser),P.game.sysTray=m,P.game.getLCS=async function(){return null},P.game.scanLCS=async function(e){let t={name:"串流服務",category:"檢測串流",getLabel:()=>T},i=await import("./agent.3fa258da.js");return await i.scan(e,t)},P.game.getProject=async function(e,t){const i=await import("./agent.649098bd.js");return await i.getProject(e,t)},P.game.getPlayer=async function(){let e=await import("./agent.af20a91c.js");return await e.getLib(),e.player},P.game.getIP=l.getIP),S.show({finish(){P.event?.enter&&(t.setting=i,P.event.enter(t)),S.blur&&S.blur(),Ve(!0)}})},leave(e){let t=e||{};t.from||(t.from=P.info.id),t.game||(t.game=P.game),P.event?.leave&&(t.setting=i,P.event.leave(t))},play(e){let t=e||{};t.from||(t.from=P.info.id),t.game||(t.game=P.game),P.event?.play&&(t.setting=i,P.event.play(t)),P.state=ct,Ve(!0)},pause(e){let t=e||{};t.from||(t.from=P.info.id),t.game||(t.game=P.game),P.event?.pause&&(t.setting=i,P.event.pause(t)),P.state=lt},focus(){S.isActive||(S.isActive=!0,P.event?.focus&&P.event.focus())},blur(){S.isActive&&(S.isActive=!1,P.event?.blur&&P.event.blur())},updateBlur(e){e&&e!==S&&S.blur();let t=x.objList;t&&Array.isArray(t)&&t.forEach((t=>{if(t){let i=t.attrs.localEvent;e!==i&&i&&i.blur&&i.blur()}}))},lock(e){d.isLock=e,d.left=x.left||"25%",d.top=x.top||"25%",d.width=x.width||"50%",d.height=x.height||"50%",Ve(!0),P.event?.lock&&P.event.lock(e)},fullscreen(e){P.event?.fullscreen&&P.event.fullscreen(e)},resize(e){P.event?.resize&&P.event.resize(e)},music(e){P.event?.music&&P.event.music(e)},sound(e){P.event?.sound&&P.event.sound(e)},show(e){let t=d.anim;if(t.element){if(t.isPlay&&(t.isPlay=!1),d.display="inline",d.disable=!1,d.zIndex=4,d.opacity=1,e){if(e.style){let t=e.style;d.zIndex=t.zIndex||4}e.finish&&e.finish()}x.updateStyle&&x.updateStyle(d),f.redraw()}},hide(e){let t=d.anim;if(t.element){if(t.isPlay&&(t.isPlay=!1),d.disable=!0,d.display="none",d.zIndex=2,d.opacity=0,e){if(e.style){let t=e.style;d.zIndex=t.zIndex||2}e.finish&&e.finish()}x.updateStyle&&x.updateStyle(d),f.redraw()}}};P.localEvent=S,P.setting=d,y.onfocus=onfocus,y.initGame=async function(e){d.anim.element=e.dom},y.event=S,y.setting=d,y.tray=m,y.objList=x.objList,y.updateStyle=x.updateStyle;let N=f(".");if("game.6.0"===d.templateVersion){let e=P.gamecard.pixiConfig;e&&(v=e.useModule?Qe:Ze,v.engine||(e.view=v.canvas,v.engine=await nt(e),v.game.setEngine(v.engine)),N=f({oninit(){},oncreate(e){e.dom.appendChild(v.canvas),P.ready&&P.ready(v.game)},onremove(e){e.dom.removeChild(v.canvas)},view:()=>f(".",{style:{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"}})}))}else N=[f("iframe",{style:{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"},scrolling:"no",frameborder:0,oncreate:async function(e){await B(!0),O=e.dom,O.scrolling="no",O.frameborder=0;let i=O.style;if(i.width="100%",i.height="100%",i.left="0%",i.top="0%",i.position="absolute",d.isChild||(i.zIndex=2,i.display="inline"),a.isIframeInit)return;a.isIframeInit=!0,y.info.iframe=O;let n=d.id,s=d.name,r=d.group,l=d.appName,c=d.background,h=d.dependence,u=null;if("object"==typeof l&&(l=d.appName[d.game.langID],l||(l=d.appName[g.EN_US])),"game.4.0"===d.templateVersion){let e=globalThis.location.origin;if(a.currentBaseURL&&(e=a.currentBaseURL),d.game.baseURL.length>0&&(e=d.game.baseURL),u={importmapName(){let e=`"${this.key}": "${this.value}"`;return this.isLast||(e+=","),e},scopemapName(){let e=`"${this.key}": "${this.value}"`;return this.isLast||(e+=","),e},appName(){let i=e;if(i.length>0&&"/"===i[i.length-1]&&(i=i.substring(0,i.length-1)),l){let e=l.split("/"),t=e.length-1;i=t>2?`${i}/${e[t-1]}/${e[t]}`:`${i}/${l}`}return t&&F&&(i=H),i},appIntegrity:"",id:n,name:s,group:r,jsName(){let e,t=globalThis.location.origin;return a.currentBaseURL&&(t=a.currentBaseURL),t&&t.length>0&&"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),e=`<script src="${t}${this.pathname}"  crossorigin><\/script>`,e},background:c},h){let e=[],t=h;Object.getOwnPropertyNames(t).forEach((i=>{let n=t[i],s={};"string"==typeof n?(s.key=i,s.pathname=n):(s.key=i,s.pathname=n.pathname,s.integrity=n.integrity),e.push(s)})),e.length>0&&(e[e.length-1].isLast=!0),u.globalmap=e}if(A){let e,t=[];e=Object.getOwnPropertyNames(A.imports),e.forEach((e=>{let i={},n=A.imports[e];i.key=e,i.value=n,t.push(i)})),t.length>0&&(t[t.length-1].isLast=!0),u.importmap=t,u.scopeName=$,t=[];let i=A.scopes[$];i&&(e=Object.getOwnPropertyNames(i),e.forEach((e=>{let n={},s=i[e];n.key=e,n.value=s,t.push(n)})),t.length>0&&(t[t.length-1].isLast=!0)),u.scopemap=t}u.jsImportShim='<script async src="/systemjs/es-module-shims.wasm.1.8.2.js"><\/script>',t&&F?(u.moduleType="-shim",u.shimOptions="\n<script  crossorigin=\"anonymous\">\nwindow.esmsInitOptions = {\nshimMode: true, // default false\nnoLoadEventRetriggers: true, // default false\nmapOverrides: true, // default false\n\n// -- Hooks --\n// Module load error\nonerror (e) {  \n  console.log('[shims] onerror', e);\n},\n\n// resolve (id, parentUrl, resolve) {\n//   console.log('[shims] resolve ', id, parentUrl);\n//   resolve(id, parentUrl);\n// },\n\nfetch (url, options) {\n  let str = url;\n  let index = url.lastIndexOf('/');\n  let filename = url.substring(index+1);\n  index = filename.lastIndexOf('.');\n  if(index < 0) {\n    url = url + '.js';\n    filename += '.js';\n  } else {\n    let ext = filename.substring(index+1);\n    // console.log(index, ext);\n  }\n  console.log('[shims] filename', filename);\n  return fetch(url, options);\n},\n\n// meta (meta, url) {\n//   console.log('[shims] meta', meta, url);\n// },\n// onimport (url, options, parentUrl) {\n//   console.log('[shims] onimport', url, options, parentUrl);\n// }\n}\n<\/script>\n"):u.moduleType="-shim",d.rendered=o.Mustache.render(o.getGameTemplate(d.templateVersion),u)}O.src="data/template/9ef1c941a7edfbb9.html",O.addEventListener("load",(()=>{if(!a.isIframeLoaded&&(a.isIframeLoaded=!0,b.updateManager.setTimeout((()=>{let e=O.contentDocument||O.contentWindow.document;e.open(),e.write(d.rendered||"!!!! unknown template !!!!"),e.close()}),.05),a.checkItem)){let e=a.checkItem,t=Math.round(performance.now());e.timeOnload=t-a.timestamp,a.timestamp=t,e.state="web",f.redraw()}}),{capture:!0,once:!0})}})];var V;y.gamePage=N,y.info={iframe:{},token:c.info.token,gameName:d.game.name,logo:d.game.baseURL+d.game.logo,version:d.game.version||"0.9.9",open(e){d.childrenVisible=!0,d.currentUrl=e,f.redraw()}},V=P.gamecard,U=V;let j=r;c.mode===j.REAL?y.info.mode=e("gameModeReal"):y.info.mode=e("gameModeDemo"),f.redraw()},onremove(){De(this.options.setting)},view(){let e,t=this.options,n=t.setting,s=t.objList||[];if(t.info&&t.info.iframe&&Pe.isMobile){t.info.iframe.style||(t.info.iframe.style={});let e=t.info.iframe.style;e.width=n.width,e.height=n.height}if(t.initGame){e=!n.isChild&&Pe.isMobile?(Pe.useFullscreen,{position:"absolute",left:"0px",top:Pe.currentY+"px",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0)"}):{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0)"},n.isCheckData&&(e={left:"0%",top:"0%",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0)"});let a="";return n.images.useBackground&&(a=n.background),f(".",{style:e},n.isChild?null:f(".center",{style:{overflowY:"hidden",position:"absolute",zIndex:1,top:"0%",left:"0%",width:`${globalThis.innerWidth}px`,height:`${globalThis.innerHeight}px`}},f(".aspect-ratio--object cover",{style:{background:`url(${a}) center`}})),f(".",{oncreate:t.initGame,style:{position:n.position,boxShadow:n.backgroundCSS,left:n.left,top:n.top,width:n.width,height:n.height,zIndex:n.zIndex||2,opacity:n.opacity,display:n.display}},t.gamePage,s.map((e=>e?(e.attrs.fix=n,e.attrs.updateBlur=t.event.updateBlur,f(e.com,e.attrs)):null)),n.sysTray&&n.sysTray.visible?f(Ie,{style:n.sysTray.style,config:n.sysTray}):null,n.sysTray&&n.sysTray.isMenu?f(_e,{tray:t.tray,event:t.event,info:t.info,config:n.sysTray}):null),n.childrenVisible?f(Xe,{url:n.currentUrl,manager:n}):null,i.msg.length>0?f(".",{style:{position:"absolute",color:"#fff",left:"50%",top:"0%",width:"64px",height:"16px",zIndex:900}},i.msg):null)}return f(".")}},ut={oninit(e){let t=e.attrs;this.options=t.options,this.saveConfig={}},oncreate(){},view(){let e=this.options,t=e.scene.pixiConfig,i=this.saveConfig;return f("article.pa4.white",f("form",[f("fieldset.ba.b--transparent.ph0.mh0",[f("legend.ph0.mh0.fw6.white","遊戲場景設定"),f(".mt3",f("label.db.fw4.lh-copy.f6","寬"),f("input.pa2.input-reset.ba.bg-transparent.w-40.red",{id:"width",name:"width",oninput(e){let n=e.target.value;i.width=parseInt(n),t.width=n},value:t&&t.width})),f(".mt3",f("label.db.fw4.lh-copy.f6","高"),f("input.b.pa2.input-reset.ba.bg-transparent.w-40.red",{id:"height",name:"height",oninput(e){let n=e.target.value;i.height=parseInt(n),t.height=n},value:t&&t.height})),f(".mt3",f("label.db.fw4.lh-copy.f6","解析度"),f("input.b.pa2.input-reset.ba.bg-transparent.w-40.red",{id:"resolution",name:"resolution",oninput(e){let n=e.target.value;i.resolution=parseFloat(n),t.resolution=n},value:t&&t.resolution})),f(".mt3",f("label.db.fw4.lh-copy.f6","是否反鋸齒"),f("input.b.pa2.input-reset.ba.bg-transparent.w-40.red",{id:"antialias",name:"antialias",oninput(e){let n=e.target.value;i.antialias=!1,"true"===n&&(i.antialias=!0),t.antialias=n},value:t&&t.antialias})),f(".mt3",f("label.db.fw4.lh-copy.f6","是否透明"),f("input.b.pa2.input-reset.ba.bg-transparent.w-40.red",{id:"transparent",name:"transparent",oninput(e){let n=e.target.value;i.transparent=!1,"true"===n&&(i.transparent=!0),t.transparent=n},value:t&&t.transparent})),f(".mt3",f("input.b.ph3.pv2.input-reset.ba.b--black.bg-transparent.grow.pointer.f6 white",{onclick(){Object.getOwnPropertyNames(i).forEach((e=>{t[e]=i[e]})),e&&e.ready&&(e.visible=!1,e.ready())},value:"確定"}))])]))}},dt=null,mt=null,pt={oninit(e){let t=this,r=e.attrs;t.style=r.style,t.options=r.options,t.resource=r.resource,t.timeout=null,t.isLeave=!1,t.isReady=!1;let o={start(){},resBegin(){},resEnd(){},sceneResBegin(){},sceneResLoading(){t.timeout&&(b.updateManager.remove(t.timeout),t.timeout=null),t.isLeave||(t.timeout=b.updateManager.setTimeout((()=>{t.isLeave=!0,t.game&&(t.game.stop(),t.game=null),t.options&&t.options.ready&&t.options.ready();let e=a;s[e.OVERVIEW_ANIMATION]=!1,s[e.OVERVIEW_PROGRESS]=!0,f.redraw(),t.timeout=null}),5))},sceneResEnd(){},finish(){t.timeout&&(b.updateManager.remove(t.timeout),t.timeout=null)}};t.initLoading=async function(e){if(!dt)try{let e=import.meta.resolve("scenes/loading");mt=e.substring(0,e.indexOf("scenes/loading")),mt+="scenes/loading",dt=await import(e)}catch(e){t.options&&t.options.ready&&t.options.ready();let i=a;return s[i.OVERVIEW_ANIMATION]=!1,s[i.OVERVIEW_PROGRESS]=!0,void f.redraw()}let l;try{l=await dt.scene.init({element:e.element,resName:"base",view:Je.canvas,langID:n(),baseURL:mt,useAvif:i.useAvif})}catch(e){}l&&(t.resource.setting=l,je(l)),await async function(e){e.resource=r.resource,e.play(),t.game=e,t.isReady=!0;try{t.scene=await dt.scene.create(e,o,b)}catch(i){t.resource.setting&&De(t.resource.setting),e.stop(),t.options&&t.options.ready&&t.options.ready();let n=a;return s[n.OVERVIEW_ANIMATION]=!1,s[n.OVERVIEW_PROGRESS]=!0,void f.redraw()}t.options&&t.options.ready&&t.options.ready()}(Je.game)}},async oncreate(e){let t=this,i=e.dom;t.initLoading&&await t.initLoading({element:i}),i.appendChild(Je.canvas),t.resource.setting&&je(t.resource.setting)},onremove(e){let t=this;e.dom.removeChild(Je.canvas),t.resource.setting&&De(t.resource.setting);let i=t.game;i&&i.stop()},view(){let e=this;return e.isReady?f(".",{id:"loading9999",style:e.style}):f(".")}},ft=a,bt={oninit(n){let a=this,r=n.attrs,o=r.setUpdateEvent;a.scene=r.scene,a.ready=r.ready,a.serve=r.serve,a.finish=r.finish,a.manager=r.manager;let l=s;if(!i.useOptions){let e=a.scene.options;if(e){l[ft.OVERVIEW_LOGO]=!1,//!!overview.logo;
h.isCheckGameCDN?l[ft.OVERVIEW_ANIMATION]=!1:l[ft.OVERVIEW_ANIMATION]=!0,l[ft.OVERVIEW_BACKGROUND]=!0,l[ft.OVERVIEW_PROGRESS]=!1;let t=e.game;t&&(l[ft.GAME_SCENE_CUSTOM]=!!t.custom,l[ft.GAME_PERFORMANCE_FPS]=!!t.fps,l[ft.GAME_DEBUG_MODE]=!!t.debug,l[ft.GAME_DIALOG_CUSTOM]=!!t.useDialog)}}a.elementLogo=null,a.progress=0,a.progressValue=0,a.baseURL=a.scene.baseURL||"",qe(a.scene.screen),Ge(),l[ft.OVERVIEW_LOGO]&&(a.setting={id:"logo",isLock:!0,useCenter:!0,left:"25%",top:"25%",width:"50%",height:"50%",game:{width:512,height:512},reference:{left:.25,top:.25,width:.5,height:.5}});a.settingBackground={id:"background",isLock:!1,left:"0%",top:"0%",width:"100%",height:"100%",game:{width:10240,height:10240},reference:{left:0,top:1,width:1,height:1}},a.message="建立預覽",a.display="inline",a.isFinish=!1,a.options={scene:a.scene,visible:!0,ready:a.ready},a.scene.pixiConfig||(s[ft.GAME_SCENE_CUSTOM]=!1);let g=h;a.manager.show=()=>{Ct.overview.visible=!0,f.redraw()},a.manager.hide=()=>{Ct.overview.visible=!1,f.redraw()},a.leave=function(){if(!h.isCheckGameCDN)if(a.isFinish=!0,g.isFinish=!0,i.isReload=!1,f.redraw(),i.disableNet){if(!Ct.manual.overview){let e=Ct.overview.manager;e.hide&&e.hide()}let e=mi(),t={id:a.scene.id},i=e.scene[t.id];i&&i.localEvent&&i.localEvent.enter(t)}else a.title=e("connecting"),a.message=e("start"),c.isKickOut||(u.isLogin?(Ht(),At()):a.serve&&ui(a.serve).then((()=>{a.title=e("quickPlay"),f.redraw()})))},a.timeout=null;let d={start(){a.message="開始讀取遊戲資料",f.redraw(),g?.loadingEvent?.start()},resBegin(e){g?.loadingEvent?.resBegin(e)},resEnd(e){g?.loadingEvent?.resEnd(e)},sceneResBegin(e){g?.loadingEvent?.sceneResBegin(e)},sceneResLoading(e){let n=0;if(Object.prototype.hasOwnProperty.call(e,"totalProgress")){let t=e.state,i=e.totalProgress;if(t){i=(t.currentIndex-1)/t.totals*100+i/t.totals}n=i.toFixed(0),a.progress=n,a.progressValue=.01*i}else{let t=e.current/e.length;n=(100*t).toFixed(0),a.progress=n,a.progressValue=t}a.isFinish||(a.timeout&&(b.updateManager.remove(a.timeout),a.timeout=null),t||(a.timeout=b.updateManager.setTimeout((()=>{i.isReload=!0,ii({url:a.baseURL,group:a.scene.group,game:a.scene.appConfig}),a.timeout=null}),5))),s[ft.OVERVIEW_PROGRESS]&&f.redraw(),g?.loadingEvent?.sceneResLoading(n)},sceneResEnd(e){g?.loadingEvent?.sceneResEnd(e)},async finish(){if(a.timeout&&(b.updateManager.remove(a.timeout),a.timeout=null),i.requestReload)return;let e=i.store;if(e)try{await e.setItem("baseURL",globalThis.BASE_URL)}catch(e){}s[ft.OVERVIEW_ANIMATION]&&a.animationLeave?a.animationLeave():a.leave(),g?.loadingEvent?.finish()}};o&&o(d)},oncreate(){let e=this;e.setting&&je(e.setting),e.settingBackground&&je(e.settingBackground),Ve(!0),i.requestReload&&(i.requestReload=!1),s[ft.GAME_SCENE_CUSTOM]||s[ft.OVERVIEW_ANIMATION]||e.options.ready&&e.options.ready()},onremove(){self.setting&&De(self.setting),self.settingBackground&&De(self.settingBackground)},onbeforeremove:e=>(["animate__animated","animate__fadeOut","animate__faster"].forEach((t=>{e.dom.classList.add(t)})),new Promise((function(t){e.dom.addEventListener("animationend",t)}))),view(){let t=this,n=h.setting,a=t.settingBackground,r=t.options;t.display,n||(n={left:"0%",top:"0%",width:"0%",height:"0%"}),Pe.isMobile&&Pe.currentY;let o="",l=i.images;return i.logo&&i.logo.length>0?(o=globalThis.innerHeight>globalThis.innerWidth?`data/img/background/logo/portrait_${i.logo}_`:`data/img/background/logo/landscape_${i.logo}_`,o+=`${i.langID}`,i.useAvif?o+=".avif":o+=".jpg"):(l&&(o=globalThis.innerHeight>globalThis.innerWidth?l.background[`${i.agent}Portrait`]:l.background[`${i.agent}Landscape`]),globalThis.BASE_URL&&(o=globalThis.BASE_URL+"agent/"+o)),f(".",{style:{display:t.display,position:"absolute",zIndex:100,left:a.left,top:`${Pe.currentY+parseInt(a.top)}px`,width:a.width,height:a.height}},f(".",{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}},f(".aspect-ratio--object cover",{style:{zIndex:0,background:`url(${o}) center`}})),s[ft.OVERVIEW_ANIMATION]?f(".",{style:{position:"absolute",left:n.left,top:n.top,width:n.width,height:n.height}},f(pt,{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"},options:r,resource:h})):null,s[ft.GAME_SCENE_CUSTOM]&&r.visible?f(".",{style:{position:"absolute",zIndex:300,left:"0%",top:"0%",width:"100%",height:"100%"}},f(".pv2 mb2 white bg-dark-green o-20",{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}}),f(".",{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}},f(ut,{options:r}))):null,s[ft.OVERVIEW_PROGRESS]&&!t.isFinish?f(".",{style:{zIndex:100,position:"absolute",left:"10%",top:"90%",width:"80%",height:"4%"}},f("progress.progress",{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"40%"},max:"100",value:`${t.progress}`}),f(".tc",{style:{position:"absolute",left:"0%",top:"30%",width:"100%",height:"60%",color:"#a0cdff"}},f("p.v-btm",`${e("loading")} ${t.progress}%`))):null)}},wt={fatal(e){},high(e){},middle(e){},low(e){}},vt={disableDialog:!1,handle(){let e=a;if(u.state="未連線",i.isInGame&&globalThis.scene){Object.getOwnPropertyNames(globalThis.scene).forEach((e=>{let t=globalThis.scene[e];t&&t.game&&t.game.disconnect&&t.game.disconnect()}))}vt.disableDialog||s[e.GAME_DIALOG_CUSTOM]&&(u.isError||b.updateManager.setTimeout((()=>{u.isError||E({title:"errorLow",msg:"disconnect"})}),2))}},yt={handle(e){let t=mi();u.state="遊戲中",vt.disableDialog=!0,l.serviceEnd(yt.report),l.log({label:"net",category:"進入遊戲"});let i={id:e.gid};k();let n=t.scene[i.id];n&&n.localEvent&&n.localEvent.enter(i)},report:{time:0,category:"進入遊戲",getLabel:()=>"net"},error:wt.low};let xt=null,Lt={position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0)"},Tt=[{style:{zIndex:10,position:"absolute",left:"5%",top:"5%",width:"30%",height:"85%"},reference:{left:.05,top:.05,width:.3,height:.85}},{style:{zIndex:10,position:"absolute",left:"35%",top:"5%",width:"30%",height:"85%"},reference:{left:.35,top:.05,width:.3,height:.85}},{style:{zIndex:10,position:"absolute",left:"65%",top:"5%",width:"30%",height:"85%"},reference:{left:.65,top:.05,width:.3,height:.85}}],Ct={overview:{visible:!0,manager:{}},packet:null,gid:null,manual:{overview:!1}},Et={visible:!1},kt="",Rt=[],Ot={oninit(e){let t=e.attrs,i=this;i.isLoading=!1;let n=t.loadingEvent,s=c,a={id:t.id,decimal:0,mode:s.mode,isCreate:!0,scene:t.scene,loadingEvent:{start(){i.isLoading=!0,n&&n.start&&n.start()},resBegin(e){n&&n.resBegin&&n.resBegin(e)},resEnd(e){n&&n.resEnd&&n.resEnd(e)},sceneResBegin(e){n&&n.sceneResBegin&&n.sceneResBegin(e)},sceneResLoading(e){n&&n.sceneResLoading&&n.sceneResLoading(e)},sceneResEnd(e){n&&n.sceneResEnd&&n.sceneResEnd(e)},finish(e){e&&e.localEvent&&(t.localEvent=e.localEvent),i.isLoading=!1,t.finish&&t.finish(e),n&&n.finish&&n.finish(e)}}},r={create:Ft,destroy:Ut,reload:It,init:Pt,clean:$t,currentGame:Ct};i.gameManager=r,i.config=a,i.style=t.style,i.reference=t.reference,i.fix=t.fix,i.absPos=t.absPos,i.updateBlur=t.updateBlur,i.isChild=t.isChild},view(){let e=this;return f(".",{style:e.style},f(ht,{updateStyle(t){if(t){let i=e.style;i.display=t.display||i.display,Object.prototype.hasOwnProperty.call(t,"opacity")&&(i.opacity=t.opacity),Object.prototype.hasOwnProperty.call(t,"zIndex")&&(i.zIndex=t.zIndex)}},gameManager:e.gameManager,config:e.config,currentBaseURL:globalThis.BASE_URL,left:"0%",top:"0%",width:"100%",height:"100%",reference:e.reference,updateBlur:e.updateBlur,fix:e.fix,isChild:e.isChild,absPos:e.absPos}))}},Mt={oninit(e){let t=e.attrs,i=this,n=t.sceneInfo;i.objList=t.objList,i.serve=t.serve,i.isReady=!1;let s={reload(){i.isReady=!1}},a={};let r=c,o={id:n.id,decimal:0,mode:r.mode,isCreate:!0,scene:n,loadingEvent:{start(){a.start&&a.start()},resBegin(e){a.resBegin&&a.resBegin(e)},resEnd(e){a.resEnd&&a.resEnd(e)},sceneResBegin(e){a.sceneResBegin&&a.sceneResBegin(e)},sceneResLoading(e){a.sceneResLoading&&a.sceneResLoading(e)},sceneResEnd(e){a.sceneResEnd&&a.sceneResEnd(e)},finish(){a.finish&&a.finish()}}};Ct.packet=null,Ct.gid=n.id||i.serve.id;let l={create:Ft,destroy:Ut,reload:It,init:Pt,clean:$t,currentGame:Ct};i.gameManager=l,i.gameConf=o,i.sceneInfo=n,i.ctrlEvent=s,i.setUpdateEvent=function(e){a=e},i.event={ready:function(){i.isReady=!0,f.redraw()},finish:function(){let e=xt.getLobby();if(e){let t=null;const s=b.Lobby.CMD;e.setLobbyCommand(s.IN_GAME,{packet:t,gid:n.id||i.serve.id})}}}},view(){let e=this,t=e.objList,i=e.gameConf,n=e.event;return f(".",{style:Lt},Et.visible&&e.isReady?f(ht,{gameManager:e.gameManager,currentBaseURL:globalThis.BASE_URL,sysTray:e.sceneInfo.sysTray,ctrlEvent:e.ctrlEvent,config:e.gameConf,zIndex:4,left:"0%",top:"0%",width:"100%",height:"100%",objList:t}):null,f(".",Ct.overview.visible?f(bt,{manager:Ct.overview.manager,serve:e.serve,scene:i.scene,setUpdateEvent:e.setUpdateEvent,ready(){n.ready()},finish(){n.finish()}}):null))}};async function It(){return new Promise((e=>{Object.getOwnPropertyNames(globalThis.scene).forEach((e=>{let t=globalThis.scene[e];t&&(delete t.event,delete t.loadingEvent),delete globalThis.scene[e]})),globalThis.scene={};let t={oncreate(){e()},view:()=>null};xt&&xt.setCurrentContext(t)}))}function _t(e){xt=e}function Pt(e){gt=i.langID,i.serve=e.serve,Ct.manual={overview:!1},Ct.overview.visible=!0,function(e){let t=null;if(e.gameCard)t=e.gameCard;else{let i;i=$(e.group),t=i[e.id]}if(!t)return;t.manual&&(Ct.manual=t.manual,t.manual.disableNet&&(i.disableNet=!0)),l.report.name=`${t.group}/${t.appConfig}`,kt=t.group;let n=t.baseURL||"",s=t.images;if(i.useAvif?s.v2&&(s=s.v2):s.v1&&(s=s.v1),s.icon){let e=document.getElementsByTagName("link");if(e){let t=e[0];if(t)if(t.setAttribute("crossorigin","icon"),t.setAttribute("rel","icon"),t.setAttribute("type","image/png"),"kc"===i.agent){let e="data/img/logo/kc/87faada2e433ffce.ico";t.setAttribute("href",e)}else t.setAttribute("href",n+s.icon)}}let a=t.app;"object"==typeof a&&(a=a[gt]),t.name[gt]?document.title=t.name[gt]:document.title=t.name[g.EN],Et.objList=Rt,Et.sceneInfo=t,Et.serve=e.serve,Et.visible=!0,xt&&xt.setCurrentContext(Mt,Et)}(e)}function Ft(e,t=0){let n=e,s=t;"number"==typeof e&&(n=t,s=e);let a=n.groupName||kt;return z(n.sceneID,a,globalThis.BASE_URL).then((e=>{let t=Tt[s],a=e.gameCard;if(!a)return;n.reloadConfig&&(a.reloadConfig=n.reloadConfig),t||(t={style:Lt,reference:{left:0,top:0,width:1,height:1}});let r={com:Ot,attrs:{loadingEvent:n.loadingEvent,index:s,style:n.style||t.style,reference:n.reference||t.reference,absPos:n.absPos||t.absPos,id:n.id,scene:a,isChild:!0,finish:function(e){i.isReload||n.finish&&n.finish(e)}}};i.isReload||(null!==Rt[s]?(Rt[s]=null,f.redraw(),b.updateManager.setTimeout((()=>{Rt[s]=r,f.redraw()}),.1)):(Rt[s]=r,f.redraw()))}))}function Ut(e){Rt[e]=null,f.redraw()}function $t(){Rt=[],Et.visible=!0,f.redraw()}let zt=!1;function Ht(){zt=!1}function At(){let e=null;if(zt)return!0;xt&&(e=xt.getLobby());const t=b.Lobby.CMD;let n=Ct,s=i,a=u;if(b.updateManager.setTimeout((()=>{"遊戲中"!==a.state&&(globalThis.Howler&&(globalThis.Howler.mute(!0),globalThis.Howler.unload()),E({title:"connecting",msg:"disconnect"}))}),.001*d),s.module?import("./agent.8ef19a36.js").then((e=>{e.ingame({name:c.game,group:c.group,gid:n.gid})})):(e&&e.setLobbyCommand(t.IN_GAME,{packet:n.packet,gid:n.gid}),l.serviceBegin(yt.report)),zt=!0,!n.manual.overview){let e=n.overview.manager;e.hide&&e.hide()}return!0}var Bt=Object.freeze({__proto__:null,clean:$t,create:Ft,currentGame:Ct,destroy:Ut,enterGame:At,imgWaiting:function(){return'<svg class="hourglass" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 206" preserveAspectRatio="none">\n  <path class="middle" d="M120 0H0v206h120V0zM77.1 133.2C87.5 140.9 92 145 92 152.6V178H28v-25.4c0-7.6 4.5-11.7 14.9-19.4 6-4.5 13-9.6 17.1-17 4.1 7.4 11.1 12.6 17.1 17zM60 89.7c-4.1-7.3-11.1-12.5-17.1-17C32.5 65.1 28 61 28 53.4V28h64v25.4c0 7.6-4.5 11.7-14.9 19.4-6 4.4-13 9.6-17.1 16.9z"/>\n  <path class="outer" d="M93.7 95.3c10.5-7.7 26.3-19.4 26.3-41.9V0H0v53.4c0 22.5 15.8 34.2 26.3 41.9 3 2.2 7.9 5.8 9 7.7-1.1 1.9-6 5.5-9 7.7C15.8 118.4 0 130.1 0 152.6V206h120v-53.4c0-22.5-15.8-34.2-26.3-41.9-3-2.2-7.9-5.8-9-7.7 1.1-2 6-5.5 9-7.7zM70.6 103c0 18 35.4 21.8 35.4 49.6V192H14v-39.4c0-27.9 35.4-31.6 35.4-49.6S14 81.2 14 53.4V14h92v39.4C106 81.2 70.6 85 70.6 103z"/>\n</svg>'},init:Pt,get isInGame(){return zt},reload:It,reset:Ht,setComRoot:_t});let St={oninit(e){let t=e.attrs,i=t.strings,n=t.dspScreen,s=t.gameManager;this.strings=i,this.dspScreen=n,t.yesno||s.clean(),this.title=t.title,this.msg=t.msg,this.setting={id:"dialog",isLock:!1,useCenter:!1,left:"0%",top:"0%",width:"100%",height:"100%",game:{width:1024,height:1024},reference:{left:0,top:0,width:1,height:1}},n.addSetting(this.setting)},oncreate(){},view(){let e=this,t=e.setting,i=null,n=e.strings,s=e.dspScreen;return i=s.state.isMobile?{position:"absolute",left:t.left,top:s.state.currentY+"px",backgroundColor:"rgba(0,0,0,1)",zIndex:990,opacity:1,width:t.width,height:t.height}:{position:"absolute",left:t.left,top:t.top,backgroundColor:"rgba(0,0,0,1)",zIndex:990,opacity:1,width:t.width,height:t.height},f(".",{style:i},f(".bg-moon-gray ba bw1",{style:{position:"absolute",left:"10%",top:"10%",width:"80%",height:"75%"}},f(".bg-near-black white f4 fw6 pa4",{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"20%"}},f(".tc",n.get(e.title)||"title")),f(".tc pa5",{style:{position:"absolute",left:"0%",top:"20%",width:"100%",height:"50%"}},f.trust(n.get(e.msg))||"body message")))}},Nt={oninit(){let e=this;e.timeValue=-1,e.touchmoveOnce=!1,e.fields=["一","二","三","四","五","六","七","八","九","十","一","二","三","四","五","六","七","八","九","十"],e.pageY=0,e.imgRotate={id:"rotate",isLock:!0,useCenter:!0,left:"10%",top:"10",width:"80%",height:"80%",game:{width:5120,height:5120},reference:{left:0,top:0,width:1,height:1}},e.imgFullscreen={id:"screen",isLock:!0,useCenter:!0,left:"10%",top:"10",width:"80%",height:"80%",game:{width:5120,height:5120},reference:{left:0,top:0,width:1,height:1}}},view(){let e=this,t=Pe,i=t.orientation,n=globalThis.innerWidth,s=globalThis.innerHeight;return i.isTrigger&&(n*=2.5,s*=2.5),t.isMobile&&t.currentY,[t.isTouchOnce&&t.isFullscreen?null:f(".",{style:{zIndex:850,position:"absolute",left:"0%",top:t.currentY+"px",width:(n||t.screenWidth)+"px",height:(s||t.screenHeight)+"px",backgroundColor:"rgba(0,0,0,1)"},ontouchmove(e){Pe.isMobile&&!Pe.ios&&e.preventDefault()},ontouchend(){if(globalThis.Howl){let e=new globalThis.Howl({src:["data/f82550ea2e80cd97.wav"]});e&&(e.volume(.001),e.play())}if(t.isFullscreen=!0,t.isTouchDown=!1,t.isTouchOnce=!0,Pe.ios){let e=globalThis.scene;t.settingList.forEach((t=>{if(e){let i=e[t.id];if(i){(i.game&&i.game.sysTray).isFullscreen=!1}}})),f.redraw(),Ve(),t.mobileReady&&t.mobileReady()}else Re().then((()=>{let e=globalThis.scene;t.settingList.forEach((t=>{if(e){let i=e[t.id];if(i){(i.game&&i.game.sysTray).isFullscreen=!0}}})),f.redraw(),Ve(),t.mobileReady&&t.mobileReady()})).catch((()=>{let e=globalThis.scene;t.settingList.forEach((t=>{if(e){let i=e[t.id];if(i){(i.game&&i.game.sysTray).isFullscreen=!1}}})),f.redraw(),Ve(),t.mobileReady&&t.mobileReady()}))},ontouchstart(i){if(globalThis.Howl){let e=new globalThis.Howl({src:["data/f82550ea2e80cd97.wav"]});e.volume(.001),e.play()}if(t.isTouchDown)return;t.isTouchDown=!0;let n=i.changedTouches||i.originalEvent.touches;if(n){let t=n[0];e.pageY=t.pageY}}},f(".",{oncreate(){je(e.imgFullscreen)},onremove(){De(e.imgFullscreen)},style:{position:"absolute",left:"10%",top:"10%",width:"80%",height:"80%"}},f("img",{src:"data/img/c7aecda7af142624.png",style:{position:"absolute",zIndex:850,left:e.imgFullscreen.left,top:e.imgFullscreen.top,width:e.imgFullscreen.width,height:e.imgFullscreen.height}}))),!i.isTrigger&&t.useOrientation&&t.usePortrait&&!t.isPortrait?f(".",{oncreate(){je(e.imgRotate),Ve(!0)},onremove(){De(e.imgRotate)},style:{zIndex:800,position:"absolute",left:"0px",top:globalThis.pageYOffset+"px",width:(globalThis.innerWidth||t.screenWidth)+"px",height:(globalThis.innerHeight||t.screenHeight)+"px",backgroundColor:"rgba(0,0,0,1)"}},f("img",{src:"data/img/f14a0482453bcc34.png",style:{position:"absolute",left:e.imgRotate.left,top:e.imgRotate.top,width:e.imgRotate.width,height:e.imgRotate.height}})):null,!i.isTrigger&&t.useOrientation&&t.useLandscape&&!t.isLandscape?f(".",{oncreate(){je(e.imgRotate),Ve(!0)},onremove(){De(e.imgRotate)},style:{zIndex:800,position:"absolute",left:"0px",top:globalThis.pageYOffset+"px",width:(globalThis.innerWidth||t.screenWidth)+"px",height:(globalThis.innerHeight||t.screenHeight)+"px",backgroundColor:"rgba(0,0,0,1)"}},f("img",{src:"data/img/b4c0d11274ffa254.gif",style:{position:"absolute",left:e.imgRotate.left,top:e.imgRotate.top,width:e.imgRotate.width,height:e.imgRotate.height}})):null]}},Vt={"game.4.0":'<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />\n  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n  <title>game 4.0 {{{name}}}</title>\n\n  {{{shimOptions}}}\n  {{{jsImportShim}}}\n\n  <script type="importmap{{{moduleType}}}">\n  {\n    "imports": {\n      {{#importmap}}\n      {{{importmapName}}}\n      {{/importmap}}\n    },\n    "scopes": {\n      "{{{scopeName}}}": {\n        {{#scopemap}}\n        {{{scopemapName}}}\n        {{/scopemap}}\n      }\n    }\n  }\n  <\/script>\n\n  {{#globalmap}}\n  {{{jsName}}}\n  {{/globalmap}}\n\n\n  <script crossorigin="anonymous">\n  if(!window.globalThis) {\n    window.globalThis = window;\n  }\n  <\/script>\n\n</head>\n<body id="{{{id}}}" style="height:100%;width:100%;overflow-x:hidden;overflow-y:hidden">\n  <script crossorigin="anonymous" type="module{{{moduleType}}}">\n    import "{{{appName}}}";\n  <\/script>\n</body>\n</html>\n'};let jt={oninit(e){let t=this,s=e.attrs,a={category:"測試CDN 主網址",getLabel:()=>"common"};l.loadBegin(a),t.cdnList=i.cdnList,t.server=c,t.ready=s.ready;let r=[];t.gamecdnFields=r,t.isFinish=!1;let g=0,h=t.cdnList.length;function u(e){g+=1,g>=h&&(t.server.cdn.errorCounts+=1,t.server.cdn.errorCounts<3?(i.requestReload=!1,i.isReload=!0,o.reload&&o.reload({url:e.target,group:e.group,game:e.appConfig||e.game})):(i.hasCDN=!1,E({yesno:!1,title:"service",msg:"errorCDN"})))}function d(e){t.isFinish||(t.isFinish=!0,e.isLight=!0,i.isCheckGameCDN=!1,t.server.cdn.errorCounts=0,l.loadEnd(a),l.log({label:"common",category:"測試CDN 主網址"}),t.ready&&t.ready(e.target))}i.isCheckGameCDN=!0,t.cdnList.forEach(((e,s)=>{let a={};a.index=s,a.isLight=!1,a.id=e.id,a.url=e.url,a.target=e.target,a.timestamp=Math.round(performance.now()),a.timeOnload=0,a.timeInit=0,a.timeScene=0,a.timeReady=9999,a.gamecard=null,a.icon="",a.isIconLoaded=!1,a.downloadEnabled=!1,a.loadingEvent={},a.ready=d,a.error=u,a.useTest=!0,r.push(a),async function(e,t,s){let a="",r=null,o=null,l=t.target,c=!1,g=n(),h=(new Date).getTime();t.group=e.group,t.game=e.game;try{if(a=e.version?`${l}${e.group}/${e.game}/config/v${e.version}`:`${l}${e.group}/${e.game}/config/gamecard.txt?v=${h}`,r=await fetch(a,{headers:{"Content-Type":"text/plain"}}),!s&&!i.isCheckGameCDN)return null;r.ok&&(o=await r.text())}catch(e){}if(!o)try{if(a=`${l}config/${e.group}/${e.game}/gamecard.txt?v=${h}`,r=await fetch(a,{headers:{"Content-Type":"text/plain"}}),!s&&!i.isCheckGameCDN)return null;r.ok&&(o=await r.text(),c=!0)}catch(e){}let u=null;if(o){u=JSON.parse(o);let n=u.images;i.useAvif?n.v2&&(n=n.v2):n.v1&&(n=n.v1);let a=null;c?(u.templateVersion="slot.2.1",a=`${l}${n.icon}`):a=`${l}${e.group}/${e.game}/${n.icon}`;let h="";"string"==typeof u.name?h+=u.name+" ":h+=u.name[g]+" ";let d=null;if("string"==typeof u.app?(d=`${l}${u.app}`,h+=u.app):(d=`${l}${u.app[g]}`,h+=u.app[g]),t.app=h,t.version=u.version,t.icon=a,t.downloadEnabled=!0,t.appConfig=u.appConfig,t.gamecard=u,t.useTest){if(d){if(r=await fetch(d),!s&&!i.isCheckGameCDN)return null;if(!r.ok)return t.error&&t.error(t),null}if(a){if(r=await fetch(a),!s&&!i.isCheckGameCDN)return null;if(!r.ok)return t.error&&t.error(t),null}t.timeReady=Math.round(performance.now()-t.timestamp),t.ready&&t.ready(t)}}else t.app="",t.version="",t.gamecard=null,t.error&&t.error(t);f.redraw()}(t.server,a)}))},oncreate(){},view:()=>f(".",{left:"0%",right:"0%",width:"100%",height:"100%",position:"absolute",zIndex:0},f(".tmp",f(".cssload-loader",f.trust('<svg class="cssload-logo" height="200" width="200"><text x="49%" y="56%" dominant-baseline="middle" text-anchor="middle" fill="#1375ff">Loading</text></svg>'),f(".cssload-inner cssload-one"),f(".cssload-inner cssload-two"),f(".cssload-inner cssload-three"))),f(".",{style:{opacity:0,left:"0%",right:"0%",width:"1px",height:"1px",position:"absolute",zIndex:0}},f("article.dt.w-100.bb.b--black-05.pb2.mt2",f("div.dtc.v-mid.pl3",f("h1.f6.f5-ns.fw6.lh-title.white.mv1.tc","檢測服務線路"),f("h2.f6.fw4.mt1.mb1.green.tc","使用的線路")))))},Dt=!1,Wt=null,Gt=["一","二","三","四","五","六","七","八","九","十","一","二","三","四","五","六","七","八","九","十"],Yt=!0,qt=null,Kt=null,Xt=null,Jt=!1,Qt=null,Zt=null,ei=null;async function ti(e){return new Promise(((t,i)=>{let n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=()=>{t()},n.onerror=()=>{i()},document.body.appendChild(n)}))}async function ii(e){if(!i.requestReload){let t={eventName:`CDN ${e.url}`,category:"服務線路錯誤",label:`${e.group}${e.game}`};l.error(t),globalThis.scene={},i.requestReload=!0,i.cdnList=[],i.hasCDN=!1,i.selectCDN=!1,Kt=null,f.redraw();let n=async function(){ei&&(await ei(),0===i.cdnList.length?hi({element:document.body}):f.redraw())};b.updateManager.setTimeout((()=>{n()}),.1)}}function ni(){Jt=!1,f.redraw()}async function si(e){Jt=!0,"string"==typeof e?(Qt={},Qt.url=e):"object"==typeof e&&(Qt=e),Qt.hideInfo=ni,Qt.comRoot={hideInfo:ni},Zt=await import("./agent.8b55d91a.js"),f.redraw()}let ai={ready(e){globalThis.BASE_URL=e,l.report.currentURL=e,i.selectCDN=!0,globalThis.scene={},f.redraw();let t=c;z(t.game,t.group,e).then((e=>{e&&e.gameCard&&Pt({gameCard:e.gameCard,serve:t,id:t.game,group:t.group})}))}},ri={context:null,view:()=>Yt?i.hasCDN&&!i.selectCDN?f(".basic",f(jt,ai)):f(".basic",Pe.isMobile?f(".",{style:{zIndex:0,position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}},Pe.orientation.isTrigger?null:Gt.map((()=>f(".ba h-25 black tc",{style:{opacity:0}},"")))):null,Kt?f(Kt,Xt):null,Pe.isMobile?f(Nt):null,y()?f(St,{strings:Wt,dspScreen:Ke,gameManager:Bt,title:L(),msg:C()}):null,Jt&&Zt?f(Zt.Component,Qt):null):i.hasCDN&&!i.selectCDN?f(".basic#root",f(jt,ai)):f(".basic#root",[Pe.isMobile?f(".",{style:{zIndex:0,position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}},Pe.orientation.isTrigger?null:Gt.map((()=>f(".ba h-25 black tc",{style:{opacity:0}},"")))):null,Kt?f(Kt,Xt):null,Pe.isMobile?f(Nt):null,y()?f(St,{strings:Wt,dspScreen:Ke,gameManager:Bt,title:L(),msg:C()}):null,Jt&&Zt?f(Zt.Component,Qt):null])};function oi(e){Yt=e}function li(e,t){Kt=e,Xt=t,f.redraw()}let ci={};function gi(e){return ci[e]}async function hi(e){let n=c;ei=e.checkCDN,Wt=e.strings,o.getGameTemplate=gi,o.reload=ii,o.getManager=mi,o.showInfo=si,o.hideInfo=ni;let s=globalThis;s.addEventListener&&(s.addEventListener("beforeunload",(e=>{})),s.addEventListener("unload",(()=>{}))),s.scene={},s.game={},ci["game.4.0"]=Vt["game.4.0"],function(){if(et)return;et=!0;let e="position: absolute; left: 0%; top: 0%; width: 100%; height: 100%;";Je.canvas=document.createElement("canvas"),Je.canvas.style=e,Je.game=new b.GameBase.Base,Je.game.init({view:Je.canvas}),Qe.canvas=document.createElement("canvas"),Qe.canvas.style=e,Qe.game=new b.GameBase.Base,Qe.game.init({view:Qe.canvas}),Ze.canvas=document.createElement("canvas"),Ze.canvas.style=e,Ze.game=new b.GameBase.Base,Ze.game.init({view:Ze.canvas})}(),_t({setCurrentContext:li,getLobby:di});let a={game:n.game,group:n.group};if(n.group&&n.game||!p){if(oi(!1),!i.hasCDN){let e=globalThis.BASE_URL,t=i.version;z(a.game,a.group,e,t).then((e=>{e&&e.gameCard&&Pt({gameCard:e.gameCard,serve:a,id:a.game,group:a.group})}))}}else Kt=S;let l=r;if(n.mode===l.DEMO){let e=840;b.updateManager.setTimeout((()=>{globalThis.Howler&&(globalThis.Howler.mute(!0),globalThis.Howler.unload()),E({title:"gameModeDemo",msg:"demoTimeout"})}),e)}if(f.mount(e.element,ri),!t)try{let e=(0,o.decode)(c.key);Date.now()-1e3*e.exp>0&&(c.isKickOut=!0,E({title:"exitGame",msg:"kickOut"}))}catch(e){}}function ui(e){let t=c;if(Dt){return new Promise((e=>{let i=t.info;qt&&(qt.login(i),e(qt))}))}return Dt=!0,e&&(t.game=e.game||t.game,t.group=e.group||t.group,t.host=e.host||t.host),new Promise((e=>{let n=globalThis;n.lobby={currentUser:{},table:{},net:{}},i.module?import("./agent.533210b4.js").then((i=>{let s=i.create();n.lobby.net.gameCommand=s;(()=>{t.host.indexOf("://")<0&&(t.host=`wss://${t.host}`);let i=t.info,n=t.host,s=t.protocol,a=t.gameFormat,r={hostname:n};import("./agent.8ef19a36.js").then((t=>{t.init({gameFormat:a,protocol:s}).then((()=>{t.connect(r).then((()=>{(async function(e){try{let t=await import("./agent.8ef19a36.js");return await t.login(e)}catch(e){}})(i).then((()=>{e(null)}))}))}))}))})()})):async function(){let e,t="/dependence/";i.selectCDN&&(t=`${globalThis.BASE_URL}dependence/`),e=["socket.io/socket.io.min.2.4.0.js"];let n=[];for(let i=0;i<e.length;i++){let s=ti(t+e[i]);n.push(s)}await Promise.all(n)}().then((async()=>{b.client.init({io:globalThis.io}),qt=new b.Lobby({},"/"+t.namespace),qt.init();let i=await import("./agent.7586a2b6.js"),n=globalThis,s=u,a=i.getCommandList(m);qt.setEventMap(a),qt.setSendEvent(i.getSendEvent()),s.state="連線中",f.redraw();let r={};r.send=qt.setGameCommand,r.registerGameEvent=qt.registerGameEvent,r.unregisterGameEvent=qt.unregisterGameEvent,n.lobby.net.gameCommand=r,n.lobby.net.setLobbyCommand=qt.setLobbyCommand,n.lobby.net.CMD=b.Lobby.CMD,n.lobby.setEvent=i.setEvent,t.host&&qt.setHost(t.host);let o=b.updateManager.setTimeout((()=>{"連線中"===s.state&&(globalThis.Howler&&(globalThis.Howler.mute(!0),globalThis.Howler.unload()),E({title:"connecting",msg:"disconnect"}))}),.001*d);qt.connect({connect(){o&&(b.updateManager.remove(o),o=null),e(qt)},disconnect(){o&&(b.updateManager.remove(o),o=null)}})}))}))}function di(){return qt}function mi(){return globalThis}var pi=Object.freeze({__proto__:null,autoLogin:ui,getCurrentContext:function(){return Kt},getGameTemplate:gi,getLobby:di,getManager:mi,hideInfo:ni,reload:ii,resetCache:function(){if(i.useCache){let e=i.registration;if(e&&e.active&&navigator.serviceWorker.controller){let e={reset:"games"};navigator.serviceWorker.controller.postMessage(e)}}},run:hi,setAccountVisible:oi,setCurrentContext:li,setKey:function(e){c.key=e},showGameList:function(){Kt=S},showInfo:si});export{yt as C,je as a,E as b,R as c,De as d,Ve as e,At as f,mi as g,k as h,di as i,wt as j,vt as k,pi as l,Pe as s};
